import{r as e,j as s,z as n}from"./vendor-react-DCALsXS8.js";import{s as r,d as a,c as t,q as o,a as i,C as c,e as l,I as m,B as d,b as u,f as g,g as h,h as b,i as f,j as N,k as p,l as _}from"./admin-analytics-BUJUGyzI.js";import{e as v,c as y,m as x,g as S,j as D,b as w}from"./vendor-ui-Bmdc4IWn.js";async function j(e,s,n){const a=`${e.toUpperCase()}${s?s.toUpperCase():n?n.substring(0,2).toUpperCase():"XX"}${(new Date).getFullYear()}`,{count:t,error:o}=await r.from("profiles").select("id",{count:"exact",head:!0}).eq("role","student").not("student_id","is",null).ilike("student_id",`${a}%`);if(o){console.error("Error counting students:",o);const{count:e}=await r.from("profiles").select("id",{count:"exact",head:!0}).eq("role","student").not("student_id","is",null);return`${a}${((e||0)+1).toString().padStart(5,"0")}`}return`${a}${((t||0)+1).toString().padStart(5,"0")}`}async function E(){const{count:e,error:s}=await r.from("profiles").select("id",{count:"exact",head:!0}).eq("role","teacher").not("teacher_code","is",null);if(s)return console.error("Error counting teachers:",s),"EYG-TCH-0001";return`EYG-TCH-${((e||0)+1).toString().padStart(4,"0")}`}async function C(){const{count:e,error:s}=await r.from("profiles").select("id",{count:"exact",head:!0}).eq("role","parent").not("parent_code","is",null);if(s)return console.error("Error counting parents:",s),"EYG-PNT-0001";return`EYG-PNT-${((e||0)+1).toString().padStart(4,"0")}`}async function A(){const{count:e,error:s}=await r.from("profiles").select("id",{count:"exact",head:!0}).in("role",["admin","business_admin","super_admin"]).not("admin_code","is",null);if(s)return console.error("Error counting admins:",s),"EYG-ADM-0001";return`EYG-ADM-${((e||0)+1).toString().padStart(4,"0")}`}async function I(e,s,n,r){switch(e){case"student":if(!s)throw new Error("Country is required for student ID generation");if(!n&&!r)throw new Error("Either state or city is required for student ID generation");return{student_id:await j(s,n||null,r)};case"teacher":return{teacher_code:await E()};case"parent":return{parent_code:await C()};case"admin":case"business_admin":case"super_admin":return{admin_code:await A()};default:return{}}}const P={IE:"IRL",GB:"GBR",US:"USA",CA:"CAN",AU:"AUS",NZ:"NZL",IN:"IND",BR:"BRA",DE:"DEU",FR:"FRA",ES:"ESP",IT:"ITA",NL:"NLD",BE:"BEL",CH:"CHE",AT:"AUT",PL:"POL",SE:"SWE",NO:"NOR",DK:"DNK",FI:"FIN",PT:"PRT",GR:"GRC",MX:"MEX",JP:"JPN",CN:"CHN",KR:"KOR",RU:"RUS",ZA:"ZAF",EG:"EGY",NG:"NGA",KE:"KEN",AR:"ARG",CL:"CHL",CO:"COL",PE:"PER",VE:"VEN",TH:"THA",VN:"VNM",PH:"PHL",MY:"MYS",SG:"SGP",ID:"IDN",PK:"PAK",BD:"BGD",TR:"TUR",SA:"SAU",AE:"ARE",IL:"ISR"};function T(e){if(!e)return"";const s=e.trim().toUpperCase();return 3===s.length?s:P[s]||s}function M(e){if(!e)return"";const s=e.trim();if(3===s.length&&s===s.toUpperCase())return s;if(2===s.length&&s===s.toUpperCase())return T(s);const n={Ireland:"IRL","United Kingdom":"GBR","Great Britain":"GBR",UK:"GBR",GB:"GBR","United States":"USA",USA:"USA",America:"USA",US:"USA",Canada:"CAN",Australia:"AUS","New Zealand":"NZL",India:"IND",Brazil:"BRA",Brasil:"BRA",Germany:"DEU",France:"FRA",Spain:"ESP",Italy:"ITA",Netherlands:"NLD",Belgium:"BEL",Switzerland:"CHE",Austria:"AUT",Poland:"POL",Sweden:"SWE",Norway:"NOR",Denmark:"DNK",Finland:"FIN"};if(n[s])return n[s];const r=s.toLowerCase(),a=Object.entries(n).find(([e])=>e.toLowerCase()===r);return a?a[1]:s}function H(e,s){if(!e)return"";return e.trim().toUpperCase()}function V(e){if(!e)return"";const s=e.trim().toUpperCase();return{IRL:"Ireland",GBR:"United Kingdom",USA:"United States of America",CAN:"Canada",AUS:"Australia",NZL:"New Zealand",IND:"India",BRA:"Brazil",DEU:"Germany",FRA:"France",ESP:"Spain",ITA:"Italy",NLD:"Netherlands",BEL:"Belgium",CHE:"Switzerland",AUT:"Austria",POL:"Poland",SWE:"Sweden",NOR:"Norway",DNK:"Denmark",FIN:"Finland",PRT:"Portugal",GRC:"Greece",MEX:"Mexico",JPN:"Japan",CHN:"China",KOR:"South Korea",RUS:"Russia",ZAF:"South Africa",EGY:"Egypt",NGA:"Nigeria",KEN:"Kenya",ARG:"Argentina",CHL:"Chile",COL:"Colombia",PER:"Peru",VEN:"Venezuela",THA:"Thailand",VNM:"Vietnam",PHL:"Philippines",MYS:"Malaysia",SGP:"Singapore",IDN:"Indonesia",PAK:"Pakistan",BGD:"Bangladesh",TUR:"Turkey",SAU:"Saudi Arabia",ARE:"United Arab Emirates",ISR:"Israel"}[s]||s}Object.entries(P).reduce((e,[s,n])=>(e[n]=s,e),{});const W=["full_name","phone","date_of_birth","age","emergency_contact","address_line_1","address_line_2","city","zip_code"];async function k(e,s,n,a,t,o="UPDATE",i,c){const l=[],m=e=>{if(null==e)return null;if("string"==typeof e){const s=e.trim();return""===s||"null"===s||"undefined"===s?null:s}if("number"==typeof e)return String(e);if("object"==typeof e){const s=JSON.stringify(e);return"{}"===s||"null"===s||'{"name":null,"phone":null,"email":null,"relationship":null}'===s?null:s}return String(e)};for(const r of W){const d=n?.[r],u=a[r],g=m(d),h=m(u);"CREATE"===o?null!==h&&l.push({table_name:e,record_id:s,field_name:r,old_value:null,new_value:h,action:"CREATE",changed_by_id:t.id,changed_by_email:t.email,changed_by_name:t.name,changed_by_role:t.role,ip_address:i,user_agent:c}):"UPDATE"===o?g!==h&&l.push({table_name:e,record_id:s,field_name:r,old_value:g,new_value:h,action:"UPDATE",changed_by_id:t.id,changed_by_email:t.email,changed_by_name:t.name,changed_by_role:t.role,ip_address:i,user_agent:c}):"DELETE"===o&&null!=d&&""!==d&&l.push({table_name:e,record_id:s,field_name:r,old_value:"object"==typeof d?JSON.stringify(d):String(d),new_value:null,action:"DELETE",changed_by_id:t.id,changed_by_email:t.email,changed_by_name:t.name,changed_by_role:t.role,ip_address:i,user_agent:c})}l.length>0&&await async function(e){if(0===e.length)return[];try{const s=e.map(e=>({table_name:e.table_name,record_id:e.record_id,field_name:e.field_name,old_value:e.old_value||null,new_value:e.new_value||null,action:e.action,changed_by_id:e.changed_by_id,changed_by_email:e.changed_by_email,changed_by_name:e.changed_by_name,changed_by_role:e.changed_by_role,ip_address:e.ip_address||null,user_agent:e.user_agent||null,changed_at:(new Date).toISOString()})),{data:n,error:a}=await r.from("audit_trail").insert(s).select();return a?(console.error("Error creating audit trail entries:",a),[]):n||[]}catch(s){return console.error("Error creating audit trail entries:",s),[]}}(l)}async function B(e={}){try{const{page:s=1,limit:n=50}=e,t=(s-1)*n;let o=r.from("audit_trail").select("*",{count:"exact"}).order("changed_at",{ascending:!1});e.table_name&&(o=o.eq("table_name",e.table_name)),e.record_id&&(o=o.eq("record_id",e.record_id)),e.field_name&&(o=o.eq("field_name",e.field_name)),e.action&&(o=o.eq("action",e.action)),e.changed_by_id&&(o=o.eq("changed_by_id",e.changed_by_id)),e.changed_by_email&&(o=o.ilike("changed_by_email",`%${e.changed_by_email}%`)),e.changed_by_role&&(o=o.eq("changed_by_role",e.changed_by_role)),e.start_date&&(o=o.gte("changed_at",e.start_date)),e.end_date&&(o=o.lte("changed_at",e.end_date)),o=o.range(t,t+n-1);const{data:i,count:c,error:l}=await o;if(l)return console.error("Error fetching audit trail entries:",l),{entries:[],total:0};const m=[...new Set((i||[]).map(e=>e.record_id))],{data:d}=await r.from("profiles").select("id, full_name, email").in("id",m),u=new Map;d&&d.forEach(e=>{const s=e.full_name?a(e.full_name):null;u.set(e.id,{name:s,email:e.email||null})});return{entries:(i||[]).map(e=>{const s=u.get(e.record_id);return{...e,old_value_encrypted:e.old_value,new_value_encrypted:e.new_value,old_value_decrypted:e.old_value?a(e.old_value):null,new_value_decrypted:e.new_value?a(e.new_value):null,affected_user_name:s?.name||null,affected_user_email:s?.email||null}}),total:c||0}}catch(s){return console.error("Error fetching audit trail entries:",s),{entries:[],total:0}}}async function q(e,s){try{let n=r.from("audit_trail").select("*");e&&(n=n.gte("changed_at",e)),s&&(n=n.lte("changed_at",s));const{data:a,error:t}=await n;if(t)return console.error("Error fetching audit trail stats:",t),{totalChanges:0,changesByAction:{},changesByTable:{},changesByField:{},changesByRole:{},recentChangers:[]};const o=a||[],i={},c={},l={},m={},d=new Map;o.forEach(e=>{i[e.action]=(i[e.action]||0)+1,c[e.table_name]=(c[e.table_name]||0)+1,l[e.field_name]=(l[e.field_name]||0)+1,m[e.changed_by_role]=(m[e.changed_by_role]||0)+1;const s=d.get(e.changed_by_id);s?s.count++:d.set(e.changed_by_id,{email:e.changed_by_email,name:e.changed_by_name,role:e.changed_by_role,count:1})});const u=Array.from(d.values()).sort((e,s)=>s.count-e.count).slice(0,10);return{totalChanges:o.length,changesByAction:i,changesByTable:c,changesByField:l,changesByRole:m,recentChangers:u}}catch(n){return console.error("Error fetching audit trail stats:",n),{totalChanges:0,changesByAction:{},changesByTable:{},changesByField:{},changesByRole:{},recentChangers:[]}}}async function U(e={}){const{entries:s}=await B({...e,limit:1e4});return s}async function F(){const e=t("users","all");return o.get(e,async()=>{const{data:e,error:s}=await r.from("profiles").select("id, full_name, email, role, student_id, created_at, updated_at, age").order("created_at",{ascending:!1});if(s)return[];return(e||[]).map(e=>i(e))},c.USER_PROFILE)}async function L(){const e=t("users","students");return o.get(e,async()=>{const{data:e,error:s}=await r.from("profiles").select("id, full_name, email, role, student_id, created_at, updated_at, age").eq("role","student").not("student_id","is",null).order("student_id",{ascending:!0});if(s)return[];return(e||[]).map(e=>i(e))},c.USER_PROFILE)}async function R(){const e=t("users","teachers");return o.get(e,async()=>{const{data:e,error:s}=await r.from("profiles").select("id, full_name, email, role, student_id, created_at, updated_at, age").eq("role","teacher").order("full_name",{ascending:!0});if(s)return[];return(e||[]).map(e=>i(e))},c.USER_PROFILE)}async function O(e){const{error:s}=await r.from("profiles").delete().eq("id",e);if(s)throw new Error("Failed to delete user");o.invalidatePattern("users:.*")}async function G(e){const s=t("users","profile",e);return o.get(s,async()=>{const{data:s,error:n}=await r.from("profiles").select("*").eq("id",e).single();if(n)return console.error("getUserProfile error:",n),null;if(s){const e=i(s);if("object"==typeof e.address&&null!==e.address)return e;const n=e,r={country:n.country||"",state:n.state||"",city:n.city||"",street:n.street||"",postal_code:n.postal_code||""};return{...e,address:r}}return s},c.USER_PROFILE)}async function $(e,s,n){const{data:a}=await r.from("profiles").select("*").eq("id",e).single();let t={...s};s.country&&(t.country=M(s.country),s.state&&(t.state=H(s.state,t.country)));const c={...l(t),updated_at:(new Date).toISOString()},{data:m,error:d}=await r.from("profiles").update(c).eq("id",e).select().single();if(d)throw new Error("Failed to update user profile");if(n&&a)try{const s=i(a);await k("profiles",e,s,t,n,"UPDATE")}catch(u){console.error("Failed to log audit trail:",u)}o.invalidatePattern("users:.*");return i(m)}async function z(e){try{console.log("getUserPermissions called with userId:",e);const{data:s,error:n}=await r.from("profiles").select("role").eq("id",e).single();if(n||!s)return console.error("Error fetching user profile:",n),[];console.log("User role found:",s.role);const{data:a,error:t}=await r.from("role_permissions").select("\n        id,\n        role,\n        permission_id,\n        permissions (\n          id,\n          name,\n          description,\n          resource,\n          action\n        )\n      ").eq("role",s.role);if(console.log("Database query result:",{data:a,error:t}),t)return console.error("Error fetching role permissions:",t),[];const o=(a||[]).filter(e=>{const s=Array.isArray(e.permissions)?e.permissions[0]:e.permissions;return s&&s.resource&&s.action}).map(s=>({id:s.id,user_id:e,permission_id:s.permission_id,permission:{...Array.isArray(s.permissions)?s.permissions[0]:s.permissions,is_active:!0,created_by:"system",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},granted_at:(new Date).toISOString(),granted_by:"system",is_active:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}));return console.log("Returning converted permissions data:",o),o}catch(s){return console.error("Error in getUserPermissions:",s),[]}}const K=async e=>{const s=(new TextEncoder).encode(e+"eyogi-salt-2024"),n=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")},Y=e.createContext(void 0),Z=()=>{const s=e.useContext(Y);if(void 0===s)throw new Error("useWebsiteAuth must be used within a WebsiteAuthProvider");return s},J=({children:n})=>{const[a,t]=e.useState(null),[i,c]=e.useState([]),[m,d]=e.useState(!0),[u,g]=e.useState(!1);e.useEffect(()=>{const e=localStorage.getItem("website-user-id");e?h(e):(d(!1),g(!0));const s=new BroadcastChannel("gdpr-deletion-channel");return s.onmessage=e=>{"user-deleted"===e.data.type&&a?.id===e.data.userId&&"admin"!==a?.role&&"business_admin"!==a?.role&&"super_admin"!==a?.role&&(t(null),c([]),localStorage.removeItem("website-user-id"),localStorage.removeItem("eyogi-ssh-local-session"),window.location.href="/")},()=>{s.close()}},[a?.id,a?.role]);const h=async e=>{try{o.invalidatePattern(`users:profile:${e}`);const n=await G(e);if(n){t(n);try{const s=(await z(e)).map(e=>({resource:e.permission?.resource||"",action:e.permission?.action||""})).filter(e=>e.resource&&e.action);c(s)}catch(s){console.warn("Failed to load user permissions:",s),c([])}}else localStorage.removeItem("website-user-id"),t(null),c([])}catch{localStorage.removeItem("website-user-id"),t(null),c([])}finally{d(!1),g(!0)}},b={user:a,loading:m,initialized:u,signIn:async(e,s)=>{try{const{data:a,error:i}=await r.from("profiles").select("*").eq("email",e.toLowerCase()).single();if(i||!a)return{error:"Invalid email or password"};if(!a.password_hash)return{error:"Account not properly configured. Please contact support."};const l=await(async(e,s)=>await K(e)===s)(s,a.password_hash);if(!l)return{error:"Invalid email or password"};if("active"!==a.status)return{error:"Account is not active. Please contact support."};o.invalidatePattern(`users:profile:${a.id}`);const m=await G(a.id);if(!m)return{error:"Failed to load user profile. Please try again."};t(m),localStorage.setItem("website-user-id",a.id);try{const e=(await z(a.id)).map(e=>({resource:e.permission?.resource||"",action:e.permission?.action||""})).filter(e=>e.resource&&e.action);c(e)}catch(n){console.error("Failed to load user permissions during sign in:",n),c([])}return{error:null}}catch{return{error:"Failed to sign in. Please try again."}}},signUp:async e=>{try{const{data:n}=await r.from("profiles").select("id").eq("email",e.email.toLowerCase()).single();if(n)return{error:"An account with this email already exists"};console.log("Creating user with email:",e.email.toLowerCase());const a=await K(e.password),t=await I(e.role,e.country,e.state,e.city),o={email:e.email.toLowerCase(),password_hash:a,full_name:e.full_name,role:e.role,status:"active",phone:e.phone||null,date_of_birth:e.date_of_birth||null,age:e.age||null,preferences:{},address_line_1:null,address_line_2:null,city:e.city||null,state:e.state||null,zip_code:null,country:e.country||null,emergency_contact:e.emergency_contact||null,avatar_url:null,parent_id:null,...t},i=l(o),{error:c}=await r.from("profiles").insert(i).select().single();if(c)return{error:`Failed to create account: ${c.message||"Unknown error"}`};try{const s=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email.toLowerCase(),fullName:e.full_name,role:e.role,status:"active"})});s.ok||console.warn("Failed to send registration email notification:",{status:s.status,statusText:s.statusText})}catch(s){console.warn("Error sending registration email:",s)}return{error:null}}catch(n){return{error:`Failed to create account: ${n instanceof Error?n.message:"Unknown error"}`}}},signOut:async()=>{t(null),c([]),localStorage.removeItem("website-user-id")},canAccess:(e,s)=>{if(!a)return!1;if("admin"===a.role||"super_admin"===a.role)return!0;return i.some(n=>n.resource===e&&n.action===s)}};return s.jsxDEV(Y.Provider,{value:b,children:n},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/contexts/WebsiteAuthContext.tsx",lineNumber:343,columnNumber:10},void 0)},X=e.createContext(void 0),Q=()=>{const s=e.useContext(X);if(void 0===s)throw new Error("useSupabaseAuth must be used within an AuthProvider");return s};async function ee(e){try{let s=r.from("batches").select("\n        id,\n        name,\n        description,\n        gurukul_id,\n        teacher_id,\n        created_by,\n        status,\n        is_active,\n        start_date,\n        end_date,\n        created_at,\n        updated_at,\n        gurukul:gurukuls (id, name, slug),\n        teacher:profiles!batches_teacher_id_fkey (id, full_name, email),\n        creator:profiles!batches_created_by_fkey (id, full_name, email)\n      ");e?.gurukul_id&&(s=s.eq("gurukul_id",e.gurukul_id)),e?.teacher_id&&(s=s.eq("teacher_id",e.teacher_id)),e?.status&&(s=s.eq("status",e.status)),void 0!==e?.is_active&&(s=s.eq("is_active",e.is_active));const{data:n,error:a}=await s.order("created_at",{ascending:!1});if(a)return console.error("Error fetching batches:",a),[];if(!n||0===n.length)return[];const t=n.map(e=>e.id),{data:o}=await r.from("batch_students").select("batch_id").in("batch_id",t).eq("is_active",!0),{data:c}=await r.from("batch_courses").select("batch_id, course:courses(*)").in("batch_id",t).eq("is_active",!0),{data:l}=await r.from("batch_progress").select("*").in("batch_id",t).order("week_number",{ascending:!0}),m=new Map,d=new Map,u=new Map,g=new Map;o?.forEach(e=>{m.set(e.batch_id,(m.get(e.batch_id)||0)+1)}),c?.forEach(e=>{d.set(e.batch_id,(d.get(e.batch_id)||0)+1),!u.has(e.batch_id)&&e.course&&u.set(e.batch_id,e.course)}),l?.forEach(e=>{g.has(e.batch_id)||g.set(e.batch_id,[]),g.get(e.batch_id)?.push(e)});return n.map(e=>{const s=g.get(e.id)||[],n=u.get(e.id)||null;let r=0;if(n&&"object"==typeof n&&"duration_weeks"in n){const e=n.duration_weeks,a=s.filter(e=>"object"==typeof e&&null!==e&&"is_completed"in e&&e.is_completed).length;r=e>0?Math.round(a/e*100):0}return{...e,teacher:e.teacher?i(e.teacher):null,creator:e.creator?i(e.creator):null,student_count:m.get(e.id)||0,course_count:d.get(e.id)||0,course:n,progress:s,progress_percentage:r,certificates_issued:e.certificates_issued||!1}})}catch(s){return console.error("Error in getBatches:",s),[]}}async function se(e){try{const{data:s,error:n}=await r.from("batches").insert({...e,id:crypto.randomUUID(),created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).select("\n        *,\n        gurukul:gurukuls (\n          id,\n          name,\n          slug,\n          description,\n          image_url\n        ),\n        teacher:profiles!batches_teacher_id_fkey (\n          id,\n          full_name,\n          email,\n          role\n        ),\n        creator:profiles!batches_created_by_fkey (\n          id,\n          full_name,\n          email,\n          role\n        )\n      ").single();if(n)throw console.error("Error creating batch:",n),new Error("Failed to create batch");return s}catch(s){throw console.error("Error in createBatch:",s),s}}async function ne(e,s){try{const{data:n,error:a}=await r.from("batches").update({...s,updated_at:(new Date).toISOString()}).eq("id",e).select("\n        *,\n        gurukul:gurukuls (\n          id,\n          name,\n          slug,\n          description,\n          image_url\n        ),\n        teacher:profiles!batches_teacher_id_fkey (\n          id,\n          full_name,\n          email,\n          role\n        ),\n        creator:profiles!batches_created_by_fkey (\n          id,\n          full_name,\n          email,\n          role\n        )\n      ").single();if(a)throw console.error("Error updating batch:",a),new Error("Failed to update batch");const{data:t}=await r.from("batch_courses").select("course:courses(*)").eq("batch_id",e).eq("is_active",!0).limit(1).single();return t&&t.course&&(n.course=t.course),n}catch(n){throw console.error("Error in updateBatch:",n),n}}async function re(e){try{const{error:s}=await r.from("batch_progress").delete().eq("batch_id",e);if(s)throw console.error("Error deleting batch progress:",s),new Error("Failed to delete batch progress records");const{error:n}=await r.from("batch_students").delete().eq("batch_id",e);if(n)throw console.error("Error deleting batch students:",n),new Error("Failed to delete batch student assignments");const{error:a}=await r.from("batch_courses").delete().eq("batch_id",e);if(a)throw console.error("Error deleting batch courses:",a),new Error("Failed to delete batch course assignments");const{error:t}=await r.from("batches").delete().eq("id",e);if(t)throw console.error("Error deleting batch:",t),new Error("Failed to delete batch")}catch(s){throw console.error("Error in deleteBatch:",s),s}}async function ae(e){try{const{data:s,error:n}=await r.from("batch_students").select("\n        *,\n        student:profiles!batch_students_student_id_fkey (\n          id,\n          full_name,\n          email,\n          student_id,\n          role\n        ),\n        batch:batches (\n          id,\n          name,\n          description,\n          status,\n          gurukul:gurukuls (\n            id,\n            name,\n            slug\n          )\n        ),\n        assigned_by_user:profiles!batch_students_assigned_by_fkey (\n          id,\n          full_name,\n          email,\n          role\n        )\n      ").eq("batch_id",e).eq("is_active",!0).order("assigned_at",{ascending:!1});if(n)return console.error("Error fetching batch students:",n),[];return(s||[]).map(e=>({...e,student:e.student?i(e.student):null,assigned_by_user:e.assigned_by_user?i(e.assigned_by_user):null}))}catch(s){return console.error("Error in getBatchStudents:",s),[]}}async function te(e,s,n){try{const{data:a,error:t}=await r.from("batch_students").insert({id:crypto.randomUUID(),batch_id:e,student_id:s,assigned_by:n,assigned_at:(new Date).toISOString(),is_active:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).select("\n        *,\n        student:profiles!batch_students_student_id_fkey (\n          id,\n          full_name,\n          email,\n          student_id,\n          role\n        ),\n        batch:batches (\n          id,\n          name,\n          description,\n          status,\n          gurukul:gurukuls (\n            id,\n            name,\n            slug\n          )\n        ),\n        assigned_by_user:profiles!batch_students_assigned_by_fkey (\n          id,\n          full_name,\n          email,\n          role\n        )\n      ").single();if(t)throw console.error("Error assigning student to batch:",t),new Error("Failed to assign student to batch");return a}catch(a){throw console.error("Error in assignStudentToBatch:",a),a}}async function oe(e,s){try{const{error:n}=await r.from("batch_students").update({is_active:!1,updated_at:(new Date).toISOString()}).eq("batch_id",e).eq("student_id",s);if(n)throw console.error("Error removing student from batch:",n),new Error("Failed to remove student from batch")}catch(n){throw console.error("Error in removeStudentFromBatch:",n),n}}async function ie(e){try{const{data:s,error:n}=await r.from("batch_courses").select("\n        *,\n        course:courses (\n          id,\n          title,\n          description,\n          level,\n          duration_weeks,\n          price,\n          max_students\n        ),\n        batch:batches (\n          id,\n          name,\n          description\n        ),\n        assigner:profiles!batch_courses_assigned_by_fkey (\n          id,\n          full_name,\n          email,\n          role\n        )\n      ").eq("batch_id",e).eq("is_active",!0).order("assigned_at",{ascending:!1});return n?(console.error("Error fetching batch courses:",n),[]):s||[]}catch(s){return console.error("Error in getBatchCourses:",s),[]}}async function ce(e,s,n){try{const{data:a}=await r.from("batch_courses").select("id, is_active").eq("batch_id",e).eq("course_id",s).single();if(a&&a.is_active)throw new Error("Course is already assigned to this batch");if(a&&!a.is_active){const{data:e,error:s}=await r.from("batch_courses").update({is_active:!0,assigned_by:n,assigned_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).eq("id",a.id).select("\n          *,\n          course:courses (\n            id,\n            title,\n            description,\n            level,\n            duration_weeks,\n            price,\n            max_students\n          ),\n          batch:batches (\n            id,\n            name,\n            description\n          ),\n          assigner:profiles!batch_courses_assigned_by_fkey (\n            id,\n            full_name,\n            email,\n            role\n          )\n        ").single();if(s)throw console.error("Error reactivating course assignment:",s),new Error("Failed to reactivate course assignment");return e}const{data:t,error:o}=await r.from("batch_courses").insert({id:crypto.randomUUID(),batch_id:e,course_id:s,assigned_by:n,assigned_at:(new Date).toISOString(),is_active:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).select("\n        *,\n        courses (\n          id,\n          title,\n          description,\n          level,\n          duration_weeks,\n          price,\n          max_students\n        ),\n        batches (\n          id,\n          name,\n          description\n        ),\n        assigner:profiles!batch_courses_assigned_by_fkey (\n          id,\n          full_name,\n          email,\n          role\n        )\n      ").single();if(o)throw console.error("Error assigning course to batch:",o),new Error("Failed to assign course to batch");return t}catch(a){throw console.error("Error in assignCourseToBatch:",a),a}}async function le(e,s){try{const{error:n}=await r.from("batch_courses").update({is_active:!1,updated_at:(new Date).toISOString()}).eq("batch_id",e).eq("course_id",s);if(n)throw console.error("Error removing course from batch:",n),new Error("Failed to remove course from batch")}catch(n){throw console.error("Error in removeCourseFromBatch:",n),n}}async function me(){try{const[{count:e,error:s},{count:n},{count:a},{count:t},{count:o},{count:i}]=await Promise.all([r.from("batches").select("id",{count:"exact",head:!0}),r.from("batches").select("id",{count:"exact",head:!0}).eq("status","active"),r.from("batches").select("id",{count:"exact",head:!0}).eq("status","in_progress"),r.from("batches").select("id",{count:"exact",head:!0}).eq("status","completed"),r.from("batches").select("id",{count:"exact",head:!0}).eq("status","archived"),r.from("batches").select("id",{count:"exact",head:!0}).eq("status","inactive")]);return s?("42P01"===s.code||s.message.includes("does not exist")||console.error("Error fetching batch stats:",s),{total:0,active:0,inactive:0,completed:0,archived:0,in_progress:0}):{total:e||0,active:(n||0)+(a||0),inactive:i||0,completed:t||0,archived:o||0,in_progress:a||0}}catch(e){return console.error("Error in getBatchStats:",e),{total:0,active:0,inactive:0,completed:0,archived:0,in_progress:0}}}async function de(e){try{const{data:s,error:n}=await r.from("batch_students").select("\n        *,\n        batch:batches (\n          id,\n          name,\n          description,\n          status,\n          start_date,\n          end_date,\n          progress_percentage,\n          gurukul:gurukuls (\n            id,\n            name,\n            slug\n          )\n        ),\n        assigned_by_user:profiles!batch_students_assigned_by_fkey (\n          id,\n          full_name,\n          email,\n          role\n        )\n      ").eq("student_id",e).eq("is_active",!0).order("assigned_at",{ascending:!1});if(n)return console.error("Error fetching student batches:",n),[];return(s||[]).map(e=>({...e,assigned_by_user:e.assigned_by_user?i(e.assigned_by_user):null}))}catch(s){return console.error("Error in getStudentBatches:",s),[]}}async function ue(e){try{const{data:s,error:n}=await r.from("batches").select("\n        *,\n        gurukul:gurukuls (\n          id,\n          name,\n          slug\n        ),\n        batch_courses!inner (\n          course:courses (\n            id,\n            title,\n            duration_weeks\n          )\n        )\n      ").eq("teacher_id",e).eq("is_active",!0).eq("progress_percentage",100);if(n)return console.error("Error fetching completed batches:",n),[];if(!s||0===s.length)return[];const a=s.map(async e=>{const{data:s,error:n}=await r.from("batch_students").select("\n          *,\n          student:user_profiles!batch_students_student_id_fkey(\n            id,\n            full_name,\n            email\n          )\n        ").eq("batch_id",e.id).eq("is_active",!0),a=(s||[]).map(e=>({...e,student:e.student?i(e.student):null}));return n?(console.error("Error fetching batch students:",n),[]):a.map(s=>({...s,name:s.student?.full_name||"Unknown Student",email:s.student?.email||"No Email",batch_name:e.name,course_title:e.batch_courses?.[0]?.course?.title||"Unknown Course"}))}),t=await Promise.all(a);return t.flat()}catch(s){return console.error("Error in getCompletedBatchStudents:",s),[]}}async function ge(e){try{const{data:s,error:n}=await r.from("batch_students").select("\n        batch_id,\n        student_id,\n        assigned_at,\n        progress_percentage,\n        progress_notes,\n        batch:batches (\n          id,\n          name,\n          description,\n          status,\n          start_date,\n          end_date,\n          progress_percentage,\n          gurukul:gurukuls (\n            id,\n            name,\n            slug\n          )\n        )\n      ").eq("student_id",e).eq("is_active",!0);if(n)return console.error("Error fetching student batches for progress:",n),[];const a=[];for(const e of s||[]){const s=e.batch_id,{data:n,error:t}=await r.from("batch_progress").select("*").eq("batch_id",s).order("week_number",{ascending:!0});if(t){console.error(`Error fetching progress for batch ${s}:`,t);continue}const{data:o,error:i}=await r.from("batch_courses").select("\n          course_id,\n          courses (\n            id,\n            title,\n            description,\n            duration_weeks,\n            course_number\n          )\n        ").eq("batch_id",s).eq("is_active",!0);if(i){console.error(`Error fetching courses for batch ${s}:`,i);continue}const c=Array.isArray(e.batch)?e.batch[0]:e.batch;if(c){const s=e.progress_percentage??c.progress_percentage??0;a.push({batch:{id:c.id,name:c.name,description:c.description,status:c.status,start_date:c.start_date,end_date:c.end_date,progress_percentage:c.progress_percentage,gurukul:Array.isArray(c.gurukul)?c.gurukul[0]:c.gurukul},assigned_at:e.assigned_at,progress:n||[],courses:o?o.map(e=>({course_id:e.course_id,courses:Array.isArray(e.courses)?e.courses[0]:e.courses})):[],total_weeks:n?.length||0,completed_weeks:n?.filter(e=>e.is_completed)?.length||0,progress_percentage:s})}}return a}catch(s){return console.error("Error in getStudentBatchProgress:",s),[]}}async function he(e,s,n,a){try{const{error:t}=await r.from("batch_progress").upsert({batch_id:e,week_number:s,is_completed:n,updated_by:a},{onConflict:"batch_id,week_number",ignoreDuplicates:!1});if(t)throw console.error("Error updating batch progress:",t),new Error("Failed to update week progress");await async function(e){try{const{data:s,error:n}=await r.from("batches").select("*").eq("id",e).single();if(n||!s)throw new Error("Failed to fetch batch information");const{data:a,error:t}=await r.from("batch_courses").select("\n        courses (\n          duration_weeks\n        )\n      ").eq("batch_id",e).eq("is_active",!0).limit(1);t&&console.error("Error fetching course data:",t);const o=a&&a.length>0?a[0].courses:null,{data:i,error:c}=await r.from("batch_progress").select("*").eq("batch_id",e);if(c)throw new Error("Failed to fetch progress records");const l=o&&"duration_weeks"in o?o.duration_weeks:0,m=i?.filter(e=>e.is_completed).length||0,d=l>0?Math.round(m/l*100):0,u={progress_percentage:d,updated_at:(new Date).toISOString()};"not_started"!==s.status&&"active"!==s.status&&"in_progress"!==s.status||(100===d?u.status="completed":d>0?u.status="in_progress":"not_started"===s.status&&(u.status="active"));const{error:g}=await r.from("batches").update(u).eq("id",e);if(g)throw console.error("Batch update error:",g),new Error(`Failed to update batch progress: ${g.message}`)}catch(s){throw console.error("Error in updateBatchOverallProgress:",s),s}}(e)}catch(t){throw console.error("Error in updateBatchProgress:",t),t}}async function be(e,s,n,a){try{const{error:t}=await r.from("batch_students").update({progress_percentage:Math.min(100,Math.max(0,n)),progress_notes:a,updated_at:(new Date).toISOString()}).eq("batch_id",e).eq("student_id",s).eq("is_active",!0);if(t)throw console.error("Error updating student progress:",t),new Error("Failed to update student progress")}catch(t){throw console.error("Error in updateStudentProgress:",t),t}}const fe=Object.freeze(Object.defineProperty({__proto__:null,assignCourseToBatch:ce,assignStudentToBatch:te,createBatch:se,deleteBatch:re,getBatchCourses:ie,getBatchStats:me,getBatchStudents:ae,getBatches:ee,getCompletedBatchStudents:ue,getStudentBatchProgress:ge,getStudentBatches:de,removeCourseFromBatch:le,removeStudentFromBatch:oe,updateBatch:ne,updateBatchProgress:he,updateStudentProgress:be},Symbol.toStringTag,{value:"Module"}));async function Ne(e){const s=t("course-assignments","teacher",e);return o.get(s,async()=>{try{const{data:s,error:n}=await r.from("course_assignments").select("\n            *,\n            courses:course_id(*)\n          ").eq("teacher_id",e).eq("is_active",!0).order("assigned_at",{ascending:!1});if(n)throw n;return s||[]}catch(s){return console.error("Error fetching teacher course assignments:",s),[]}},c.COURSES)}async function pe(e,s,n,a){try{const t={course_id:e,teacher_id:s,assigned_by:n,assigned_at:(new Date).toISOString(),is_active:!0};a&&(t.notes=a),console.log("Inserting course assignment:",{courseId:e,teacherId:s,assignedBy:n,courseIdLength:e.length,teacherIdLength:s.length,assignedByLength:n.length});const{data:i,error:c}=await r.from("course_assignments").insert(t).select().single();if(c)throw console.error("Database error assigning course:",{error:c,message:c.message,code:c.code,details:c.details,hint:c.hint,courseId:e,teacherId:s,assignedBy:n}),new Error(c.message||"Failed to assign course");return o.invalidatePattern("course-assignments:.*"),o.invalidatePattern("courses:.*"),i}catch(t){throw t instanceof Error?console.error("Error assigning course to teacher:",{message:t.message,stack:t.stack,courseId:e,teacherId:s}):console.error("Error assigning course to teacher:",t),t}}const _e={AdminDashboard:["admin","business_admin","super_admin"],AdminSidebar:["admin","business_admin","super_admin"],CertificateManagement:["admin","business_admin","super_admin"],CourseManagement:["admin","business_admin","teacher","super_admin"],EnrollmentManagement:["admin","business_admin","teacher","super_admin"],StudentManagement:["admin","business_admin","teacher","super_admin"],GurukulManagement:["admin","business_admin","super_admin"],ContentManagement:["admin","business_admin","super_admin"],BatchManagement:["admin","business_admin","super_admin"],SiteAnalytics:["admin","super_admin"],AdminPermissionManagement:["admin","super_admin"],AdminUserManagementNew:["admin","super_admin"],TeacherDashboard:["teacher","admin","super_admin"],StudentDashboard:["student","admin","super_admin"]};function ve(){const{user:s,canAccess:n}=Z(),{profile:a,user:t}=Q(),[o,i]=e.useState({}),[c,l]=e.useState({}),[m,d]=e.useState(!1);e.useEffect(()=>{(async()=>{if(t&&a)try{d(!0);const{data:e,error:s}=await r.from("role_permissions").select("permission_id, menu_visible, permissions(resource, action)").eq("role",a.role);if(s)return void console.error("Error loading menu visibility:",s);const n={},t={};e?.forEach(e=>{if(e.permissions){const s=`${e.permissions.resource}.${e.permissions.action}`;n[s]=e.menu_visible??!0,t[s]=!0}}),i(n),l(t)}catch(e){console.error("Failed to load menu visibility:",e)}finally{d(!1)}})()},[t,a]);const u=()=>t&&a?a.role:s?.role||null,g=()=>"super_admin"===u();return{canAccessComponent:e=>{if(t&&a){return _e[e].includes(a.role)}if(s){return _e[e].includes(s.role)}return!1},canAccessResource:(e,r="read")=>{if(t&&a){if("super_admin"===a.role)return!0;if("admin"===a.role)return!0;const s=`${e.toLowerCase()}.${r}`;return c[s]??!1}return!!s&&n(e,r)},canShowInMenu:(e,s="read")=>{if(t&&a&&("super_admin"===a.role||"admin"===a.role))return!0;return o[`${e}.${s}`]??!1},getUserRole:u,isTeacher:()=>"teacher"===u(),isBusinessAdmin:()=>"business_admin"===u(),isAdmin:()=>"admin"===u(),isSuperAdminRole:g,isStudent:()=>"student"===u(),currentUser:t&&a?a:s,isSuperAdmin:g(),isLoadingMenuVisibility:m}}function ye(s){const[a,t]=e.useState([]),[o,c]=e.useState(!0),[l,m]=e.useState(null),d=e.useCallback(async()=>{try{c(!0),m(null);let e=r.from("course_assignments").select("\n          *,\n          courses(*)\n        ").eq("is_active",!0).order("assigned_at",{ascending:!1});const{data:s,error:a}=await e;if(a)return console.error("Error loading assignments:",a),m("Failed to load course assignments"),void n.error("Failed to load course assignments");const o=[...new Set(s?.map(e=>e.teacher_id).filter(Boolean))],{data:l}=await r.from("profiles").select("*").in("id",o).eq("role","teacher"),d=(l||[]).map(e=>i(e)),u=new Map(d.map(e=>[e.id,e])),g=s?.map(e=>({...e,course:e.courses,teacher:u.get(e.teacher_id)}));t(g||[])}catch{m("Failed to load course assignments")}finally{c(!1)}},[s]);return e.useEffect(()=>{d()},[s,d]),{assignments:a,loading:o,error:l,loadAssignments:d,assignTeacherToCourse:async(e,s,a,t)=>{try{const{data:o}=await r.from("profiles").select("id, role, teacher_code").eq("id",e).eq("role","teacher").single();if(!o)return n.error("Teacher profile not found"),!1;const{data:i}=await r.from("course_assignments").select("id").eq("teacher_id",o.id).eq("course_id",s).eq("is_active",!0).maybeSingle();if(i)return n.error("Teacher is already assigned to this course"),!1;const{error:c}=await r.from("course_assignments").insert({teacher_id:o.id,course_id:s,assigned_by:a,notes:t,is_active:!0});return c?(n.error("Failed to assign teacher to course: "+(c.message||"Unknown error")),!1):(n.success("Teacher assigned to course successfully"),await d(),!0)}catch(o){return n.error("Failed to assign teacher to course: "+(o instanceof Error?o.message:"Unknown error")),!1}},removeAssignment:async e=>{try{const{error:s}=await r.from("course_assignments").update({is_active:!1}).eq("id",e);return s?(n.error("Failed to remove assignment"),!1):(n.success("Assignment removed successfully"),await d(),!0)}catch{return n.error("Failed to remove assignment"),!1}},getTeacherCourses:async e=>{try{const{data:s,error:n}=await r.from("course_assignments").select("\n          course:courses(*)\n        ").eq("teacher_id",e).eq("is_active",!0);return n?[]:(s||[]).map(e=>e.course).filter(Boolean)}catch{return[]}},getAssignedTeachers:async e=>{try{const{data:s,error:n}=await r.from("course_assignments").select("teacher_id").eq("course_id",e).eq("is_active",!0);if(n)return[];const a=[...new Set(s?.map(e=>e.teacher_id).filter(Boolean))];if(0===a.length)return[];const{data:t}=await r.from("profiles").select("*").in("id",a).eq("role","teacher");return(t||[]).map(e=>i(e))}catch{return[]}}}}const xe=({isOpen:a,onClose:t,onAssign:o})=>{const[c,l]=e.useState([]),[u,g]=e.useState([]),[h,b]=e.useState(""),[f,N]=e.useState(""),[p,_]=e.useState(""),[v,y]=e.useState(!1);e.useEffect(()=>{a&&x()},[a]);const x=async()=>{try{const[e,s]=await Promise.all([r.from("profiles").select("*").eq("role","teacher").eq("status","active").order("full_name"),r.from("courses").select("*").eq("is_active",!0).order("title")]),n=(e.data||[]).map(e=>i(e));l(n),g(s.data||[])}catch{n.error("Failed to load teachers and courses")}};return a?s.jsxDEV("div",{className:"fixed inset-0 backdrop-blur-sm bg-white/30 flex items-center justify-center z-50",children:s.jsxDEV("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4 shadow-2xl border border-gray-300",children:[s.jsxDEV("div",{className:"flex justify-between items-center bg-gradient-to-r from-blue-500 to-purple-600 -m-6 mb-4 p-6 rounded-t-lg",children:[s.jsxDEV("h3",{className:"text-lg font-semibold text-white",children:"Assign Teacher to Course"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:78,columnNumber:11},void 0),s.jsxDEV("button",{onClick:t,className:"text-white/80 hover:text-white cursor-pointer",children:s.jsxDEV(w,{className:"h-6 w-6"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:80,columnNumber:13},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:79,columnNumber:11},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:77,columnNumber:9},void 0),s.jsxDEV("div",{className:"space-y-4",children:[s.jsxDEV("div",{children:[s.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teacher"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:85,columnNumber:13},void 0),s.jsxDEV("select",{value:h,onChange:e=>b(e.target.value),className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsxDEV("option",{value:"",children:"Select a teacher"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:91,columnNumber:15},void 0),c.map(e=>s.jsxDEV("option",{value:e.id,children:[e.full_name," (",e.email,")",e.teacher_code?` - ${e.teacher_code}`:""]},e.id,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:93,columnNumber:17},void 0))]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:86,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:84,columnNumber:11},void 0),s.jsxDEV("div",{children:[s.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Course"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:101,columnNumber:13},void 0),s.jsxDEV("select",{value:f,onChange:e=>N(e.target.value),className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsxDEV("option",{value:"",children:"Select a course"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:107,columnNumber:15},void 0),u.map(e=>s.jsxDEV("option",{value:e.id,children:[e.title," (",e.course_number,")"]},e.id,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:109,columnNumber:17},void 0))]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:102,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:100,columnNumber:11},void 0),s.jsxDEV("div",{children:[s.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:116,columnNumber:13},void 0),s.jsxDEV(m,{value:p,onChange:e=>_(e.target.value),placeholder:"Assignment notes or comments"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:117,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:115,columnNumber:11},void 0),s.jsxDEV("div",{className:"flex space-x-3 pt-4",children:[s.jsxDEV(d,{onClick:async()=>{if(!h||!f)return void n.error("Please select both teacher and course");y(!0);await o(h,f,p)&&(b(""),N(""),_(""),t()),y(!1)},disabled:v,className:"flex-1",children:v?"Assigning...":"Assign"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:124,columnNumber:13},void 0),s.jsxDEV(d,{variant:"danger",onClick:t,className:"flex-1",children:"Cancel"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:127,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:123,columnNumber:11},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:83,columnNumber:9},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:76,columnNumber:7},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:75,columnNumber:5},void 0):null},Se=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[r,a]=e.useState(""),[t,o]=e.useState(!1),[i,c]=e.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),{assignments:l,loading:f,assignTeacherToCourse:N,removeAssignment:p}=ye(),{currentUser:_}=ve(),w=l.filter(e=>e.course?.title.toLowerCase().includes(r.toLowerCase())||e.teacher?.full_name?.toLowerCase().includes(r.toLowerCase())||e.course?.course_number.toLowerCase().includes(r.toLowerCase()));return f?s.jsxDEV("div",{className:"flex items-center justify-center p-8",children:s.jsxDEV("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:179,columnNumber:9},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:178,columnNumber:7},void 0):s.jsxDEV("div",{className:"space-y-6",children:[s.jsxDEV("div",{className:"flex items-center space-x-4",children:[s.jsxDEV("div",{className:"flex-1 relative",children:[s.jsxDEV(v,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:187,columnNumber:11},void 0),s.jsxDEV(m,{type:"text",placeholder:"Search assignments...",value:r,onChange:e=>a(e.target.value),className:"pl-10"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:188,columnNumber:11},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:186,columnNumber:9},void 0),s.jsxDEV(d,{onClick:()=>o(!0),className:"flex items-center space-x-2",children:[s.jsxDEV(y,{className:"h-4 w-4"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:197,columnNumber:11},void 0),s.jsxDEV("span",{children:"New Assignment"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:198,columnNumber:11},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:196,columnNumber:9},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:185,columnNumber:7},void 0),0===w.length?s.jsxDEV(u,{children:s.jsxDEV(g,{className:"p-8 text-center",children:[s.jsxDEV(x,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:204,columnNumber:13},void 0),s.jsxDEV("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No assignments found"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:205,columnNumber:13},void 0),s.jsxDEV("p",{className:"text-gray-600",children:r?"No assignments match your search.":"Start by creating your first course assignment."},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:206,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:203,columnNumber:11},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:202,columnNumber:9},void 0):s.jsxDEV("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:s.jsxDEV("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsxDEV("thead",{className:"bg-gray-50",children:s.jsxDEV("tr",{children:[s.jsxDEV("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Course"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:218,columnNumber:17},void 0),s.jsxDEV("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Course Number"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:221,columnNumber:17},void 0),s.jsxDEV("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Teacher"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:224,columnNumber:17},void 0),s.jsxDEV("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assigned Date"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:227,columnNumber:17},void 0),s.jsxDEV("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Notes"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:230,columnNumber:17},void 0),s.jsxDEV("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:233,columnNumber:17},void 0),s.jsxDEV("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:236,columnNumber:17},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:217,columnNumber:15},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:216,columnNumber:13},void 0),s.jsxDEV("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(e=>s.jsxDEV("tr",{className:"hover:bg-gray-50",children:[s.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:s.jsxDEV("div",{className:"flex items-center",children:[s.jsxDEV("div",{className:"h-6 w-6 bg-blue-100 rounded-full flex items-center justify-center mr-2",children:s.jsxDEV(S,{className:"h-3 w-3 text-blue-600"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:247,columnNumber:25},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:246,columnNumber:23},void 0),s.jsxDEV("div",{className:"text-sm font-medium text-gray-900",children:e.course?.title},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:249,columnNumber:23},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:245,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:244,columnNumber:19},void 0),s.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:s.jsxDEV("span",{className:"text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded-md",children:e.course?.course_number},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:255,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:254,columnNumber:19},void 0),s.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:s.jsxDEV("div",{className:"text-sm text-gray-900",children:e.teacher?.full_name},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:260,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:259,columnNumber:19},void 0),s.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:s.jsxDEV("div",{className:"text-sm text-gray-900",children:new Date(e.assigned_at).toLocaleDateString()},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:263,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:262,columnNumber:19},void 0),s.jsxDEV("td",{className:"px-4 py-3",children:s.jsxDEV("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:e.notes||"-"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:268,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:267,columnNumber:19},void 0),s.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:s.jsxDEV(h,{className:"bg-green-100 text-green-800",size:"sm",children:"Active"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:273,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:272,columnNumber:19},void 0),s.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:s.jsxDEV(d,{variant:"ghost",size:"sm",onClick:()=>(async e=>{c({isOpen:!0,title:"Remove Assignment",message:"Are you sure you want to remove this assignment?",onConfirm:async()=>{await p(e),c(e=>({...e,isOpen:!1}))}})})(e.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 border-0",children:s.jsxDEV(D,{className:"h-4 w-4"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:284,columnNumber:23},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:278,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:277,columnNumber:19},void 0)]},e.id,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:243,columnNumber:17},void 0))},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:241,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:215,columnNumber:11},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:214,columnNumber:9},void 0),s.jsxDEV(xe,{isOpen:t,onClose:()=>o(!1),onAssign:async(e,s,r)=>_?.id?await N(e,s,_.id,r):(n.error("Unable to identify current user"),!1)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:293,columnNumber:7},void 0),s.jsxDEV(b,{isOpen:i.isOpen,title:i.title,message:i.message,onConfirm:i.onConfirm,onCancel:()=>c(e=>({...e,isOpen:!1})),variant:"danger"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:299,columnNumber:7},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentManagement.tsx",lineNumber:184,columnNumber:5},void 0)}},Symbol.toStringTag,{value:"Module"})),De=({batch:n,onClose:r,onSuccess:a})=>{const[t,o]=e.useState([]),[i,c]=e.useState([]),[l,m]=e.useState([]),[u,g]=e.useState(""),[b,_]=e.useState(!0),[x,S]=e.useState(!1),{profile:j}=Q(),E=ye(),C=e.useCallback(async()=>{_(!0);try{const e=await ie(n.id);let s;o(e),s=n.teacher_id?await E.getTeacherCourses(n.teacher_id):await f({gurukul_id:n.gurukul_id});const r=new Set(e.map(e=>e.course_id)),a=s.filter(e=>e.is_active&&!r.has(e.id));c(a)}catch(e){console.error("Error fetching data:",e)}finally{_(!1)}},[n.id,n.gurukul_id,n.teacher_id]);e.useEffect(()=>{C()},[C]);const A=e=>{m(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},I=i.filter(e=>e.title.toLowerCase().includes(u.toLowerCase())||e.description.toLowerCase().includes(u.toLowerCase())||e.course_number.toLowerCase().includes(u.toLowerCase()));return b?s.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxDEV("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxDEV("div",{className:"p-6",children:s.jsxDEV("div",{className:"animate-pulse space-y-4",children:[s.jsxDEV("div",{className:"h-6 bg-gray-200 rounded w-1/3"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:122,columnNumber:15},void 0),s.jsxDEV("div",{className:"h-4 bg-gray-200 rounded w-1/2"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:123,columnNumber:15},void 0),s.jsxDEV("div",{className:"space-y-2",children:[...Array(5)].map((e,n)=>s.jsxDEV("div",{className:"h-12 bg-gray-200 rounded"},n,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:126,columnNumber:19},void 0))},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:124,columnNumber:15},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:121,columnNumber:13},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:120,columnNumber:11},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:119,columnNumber:9},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:118,columnNumber:7},void 0):s.jsxDEV("div",{className:"fixed inset-0 backdrop-blur-sm bg-white/30 flex items-center justify-center z-50 p-4",children:s.jsxDEV("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl border border-gray-300",children:[s.jsxDEV("div",{className:"flex justify-between items-center p-6 border-b bg-gradient-to-r from-blue-500 to-purple-600",children:[s.jsxDEV("div",{children:[s.jsxDEV("h2",{className:"text-xl font-semibold text-white",children:"Manage Courses"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:141,columnNumber:13},void 0),s.jsxDEV("p",{className:"text-white/90",children:["Batch: ",n.name]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:142,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:140,columnNumber:11},void 0),s.jsxDEV("button",{onClick:r,className:"text-white/80 hover:text-white",children:s.jsxDEV(w,{className:"h-6 w-6"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:145,columnNumber:13},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:144,columnNumber:11},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:139,columnNumber:9},void 0),s.jsxDEV("div",{className:"p-6",children:[s.jsxDEV("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxDEV("div",{children:[s.jsxDEV("h3",{className:"text-lg font-medium mb-4",children:["Assigned Courses (",t.length,")"]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:153,columnNumber:15},void 0),s.jsxDEV("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:0===t.length?s.jsxDEV("div",{className:"text-center py-8 text-gray-500",children:"No courses assigned to this batch yet."},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:158,columnNumber:19},void 0):t.map(e=>s.jsxDEV("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[s.jsxDEV("div",{className:"flex-1",children:[s.jsxDEV("div",{className:"font-medium",children:e.course?.title||"Unknown Course"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:168,columnNumber:25},void 0),s.jsxDEV("div",{className:"text-sm text-gray-600",dangerouslySetInnerHTML:{__html:N(e.course?.description||"")}},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:171,columnNumber:25},void 0),s.jsxDEV("div",{className:"flex items-center gap-2 mt-2",children:[s.jsxDEV(h,{size:"sm",className:p(e.course?.level||""),children:e.course?.level},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:178,columnNumber:27},void 0),s.jsxDEV(h,{size:"sm",variant:"outline",children:[e.course?.duration_weeks," weeks"]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:184,columnNumber:27},void 0),s.jsxDEV(h,{size:"sm",variant:"outline",children:["",e.course?.price]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:187,columnNumber:27},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:177,columnNumber:25},void 0),s.jsxDEV("div",{className:"text-xs text-gray-500 mt-1",children:["Assigned: ",new Date(e.assigned_at).toLocaleDateString()]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:191,columnNumber:25},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:167,columnNumber:23},void 0),s.jsxDEV(d,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(j&&window.confirm("Are you sure you want to remove this course from the batch?"))try{await le(n.id,e),await C(),a()}catch(s){console.error("Error removing course:",s),alert("Failed to remove course. Please try again.")}})(e.course_id),className:"text-red-600 hover:text-red-700 border-red-200 hover:border-red-300",children:s.jsxDEV(D,{className:"h-4 w-4"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:201,columnNumber:25},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:195,columnNumber:23},void 0)]},e.id,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:163,columnNumber:21},void 0))},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:156,columnNumber:15},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:152,columnNumber:13},void 0),s.jsxDEV("div",{children:[s.jsxDEV("div",{className:"flex justify-between items-center mb-4",children:[s.jsxDEV("h3",{className:"text-lg font-medium",children:["Available Courses (",I.length,")"]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:212,columnNumber:17},void 0),l.length>0&&s.jsxDEV(d,{onClick:async()=>{if(j&&0!==l.length){S(!0);try{await Promise.all(l.map(e=>ce(n.id,e,j.id))),await C(),m([]),a()}catch(e){console.error("Error assigning courses:",e),alert("Failed to assign courses. Please try again.")}finally{S(!1)}}},disabled:x,className:"flex items-center space-x-2",children:[s.jsxDEV(y,{className:"h-4 w-4"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:221,columnNumber:21},void 0),s.jsxDEV("span",{children:x?"Assigning...":`Assign ${l.length}`},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:222,columnNumber:21},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:216,columnNumber:19},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:211,columnNumber:15},void 0),s.jsxDEV("div",{className:"relative mb-4",children:[s.jsxDEV(v,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:229,columnNumber:17},void 0),s.jsxDEV("input",{type:"text",value:u,onChange:e=>g(e.target.value),placeholder:"Search courses...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:230,columnNumber:17},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:228,columnNumber:15},void 0),s.jsxDEV("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:0===I.length?s.jsxDEV("div",{className:"text-center py-8 text-gray-500",children:u?"No courses found matching your search.":"No available courses to assign."},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:241,columnNumber:19},void 0):I.map(e=>s.jsxDEV("div",{className:"flex items-center p-3 border rounded-lg cursor-pointer transition-colors "+(l.includes(e.id)?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-gray-300"),onClick:()=>A(e.id),children:[s.jsxDEV("input",{type:"checkbox",checked:l.includes(e.id),onChange:()=>A(e.id),className:"mr-3 h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:257,columnNumber:23},void 0),s.jsxDEV("div",{className:"flex-1",children:[s.jsxDEV("div",{className:"font-medium",children:e.title},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:264,columnNumber:25},void 0),s.jsxDEV("div",{className:"text-sm text-gray-600 line-clamp-2",dangerouslySetInnerHTML:{__html:N(e.description)}},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:265,columnNumber:25},void 0),s.jsxDEV("div",{className:"flex items-center flex-wrap gap-2 mt-2",children:[s.jsxDEV(h,{size:"sm",className:p(e.level),children:e.level},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:270,columnNumber:27},void 0),s.jsxDEV(h,{size:"sm",variant:"outline",children:e.course_number},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:273,columnNumber:27},void 0),s.jsxDEV(h,{size:"sm",variant:"outline",children:[e.duration_weeks," weeks"]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:276,columnNumber:27},void 0),s.jsxDEV(h,{size:"sm",variant:"outline",children:["",e.price]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:279,columnNumber:27},void 0),s.jsxDEV(h,{size:"sm",variant:"info",children:["Max: ",e.max_students]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:282,columnNumber:27},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:269,columnNumber:25},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:263,columnNumber:23},void 0)]},e.id,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:248,columnNumber:21},void 0))},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:239,columnNumber:15},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:210,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:150,columnNumber:11},void 0),s.jsxDEV("div",{className:"flex justify-end space-x-3 pt-6 border-t mt-6",children:s.jsxDEV(d,{variant:"outline",onClick:r,children:"Close"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:295,columnNumber:13},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:294,columnNumber:11},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:149,columnNumber:9},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:138,columnNumber:7},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/CourseAssignmentModal.tsx",lineNumber:137,columnNumber:5},void 0)},we=({teacherIds:r,teacherNames:a,onClose:t,onSuccess:o})=>{const[i,c]=e.useState([]),[l,m]=e.useState([]),[u,g]=e.useState(new Set),[b,N]=e.useState([]),[p,y]=e.useState(""),[x,S]=e.useState(!0),[D,j]=e.useState(!1),{profile:E}=Q();e.useEffect(()=>{C()},[]);const C=async()=>{S(!0);try{const[e,s]=await Promise.all([f({}),_()]),n=e.filter(e=>e.is_active);c(n),m(s)}catch(e){console.error("Error fetching data:",e),n.error("Failed to load courses and gurukuls")}finally{S(!1)}},A=e=>{N(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},I=i.filter(e=>e.title.toLowerCase().includes(p.toLowerCase())||e.description&&e.description.toLowerCase().includes(p.toLowerCase())||e.course_number.toLowerCase().includes(p.toLowerCase()));return x?s.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxDEV("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxDEV("div",{className:"p-6",children:s.jsxDEV("div",{className:"animate-pulse flex flex-col gap-4",children:[s.jsxDEV("div",{className:"h-6 bg-gray-200 rounded w-1/3"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:157,columnNumber:15},void 0),s.jsxDEV("div",{className:"h-4 bg-gray-200 rounded w-1/2"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:158,columnNumber:15},void 0),s.jsxDEV("div",{className:"flex flex-col gap-2",children:[...Array(5)].map((e,n)=>s.jsxDEV("div",{className:"h-12 bg-gray-200 rounded"},n,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:161,columnNumber:19},void 0))},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:159,columnNumber:15},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:156,columnNumber:13},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:155,columnNumber:11},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:154,columnNumber:9},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:153,columnNumber:7},void 0):s.jsxDEV("div",{className:"fixed inset-0 backdrop-blur-sm bg-white/30 flex items-center justify-center z-50 p-4",children:s.jsxDEV("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl border border-gray-300",children:[s.jsxDEV("div",{className:"flex justify-between items-center p-6 border-b bg-gradient-to-r from-blue-500 to-purple-600",children:[s.jsxDEV("div",{children:[s.jsxDEV("h2",{className:"text-xl font-semibold text-white",children:"Assign Courses to Teachers"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:176,columnNumber:13},void 0),s.jsxDEV("p",{className:"text-white/90 text-sm",children:["Assigning courses to ",r.length," teacher",1!==r.length?"s":""]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:177,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:175,columnNumber:11},void 0),s.jsxDEV("button",{onClick:t,className:"text-white/80 hover:text-white",children:s.jsxDEV(w,{className:"h-6 w-6"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:182,columnNumber:13},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:181,columnNumber:11},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:174,columnNumber:9},void 0),s.jsxDEV("div",{className:"p-6",children:[s.jsxDEV("div",{className:"mb-6",children:[s.jsxDEV("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Selected Teachers:"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:189,columnNumber:13},void 0),s.jsxDEV("div",{className:"flex flex-wrap gap-2",children:a.map((e,n)=>s.jsxDEV(h,{className:"bg-blue-100 text-blue-800",children:e},n,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:192,columnNumber:17},void 0))},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:190,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:188,columnNumber:11},void 0),s.jsxDEV("div",{className:"mb-4",children:s.jsxDEV("div",{className:"relative",children:[s.jsxDEV(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:202,columnNumber:15},void 0),s.jsxDEV("input",{type:"text",placeholder:"Search courses by title, number, or description...",value:p,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:203,columnNumber:15},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:201,columnNumber:13},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:200,columnNumber:11},void 0),s.jsxDEV("div",{className:"mb-6",children:[s.jsxDEV("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Select by Gurukul (optional):"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:215,columnNumber:13},void 0),s.jsxDEV("div",{className:"flex flex-wrap gap-2",children:l.map(e=>{const n=i.filter(s=>s.gurukul_id===e.id).length,r=u.has(e.id);return s.jsxDEV("button",{onClick:()=>(e=>{const s=u.has(e),n=i.filter(s=>s.gurukul_id===e).map(e=>e.id);s?(g(s=>{const n=new Set(s);return n.delete(e),n}),N(e=>e.filter(e=>!n.includes(e)))):(g(s=>new Set(s).add(e)),N(e=>{const s=[...e];return n.forEach(e=>{s.includes(e)||s.push(e)}),s}))})(e.id),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+(r?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.name," (",n,")"]},e.id,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:225,columnNumber:19},void 0)})},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:218,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:214,columnNumber:11},void 0),s.jsxDEV("div",{className:"mb-6",children:[s.jsxDEV("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:["Available Courses (",I.length,"):"]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:243,columnNumber:13},void 0),s.jsxDEV("div",{className:"max-h-96 overflow-y-auto border border-gray-200 rounded-lg",children:0===I.length?s.jsxDEV("div",{className:"p-6 text-center text-gray-500",children:"No courses found"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:248,columnNumber:17},void 0):I.map(e=>s.jsxDEV("div",{onClick:()=>A(e.id),className:"p-4 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors "+(b.includes(e.id)?"bg-orange-50":""),children:s.jsxDEV("div",{className:"flex items-start justify-between",children:s.jsxDEV("div",{className:"flex-1",children:[s.jsxDEV("div",{className:"flex items-center gap-2 mb-1",children:[s.jsxDEV("input",{type:"checkbox",checked:b.includes(e.id),onChange:()=>A(e.id),className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:261,columnNumber:27},void 0),s.jsxDEV("h4",{className:"font-medium text-gray-900",children:e.title},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:267,columnNumber:27},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:260,columnNumber:25},void 0),s.jsxDEV("p",{className:"text-sm text-gray-600 ml-6",children:[e.course_number,"  ",e.level]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:269,columnNumber:25},void 0),e.description&&s.jsxDEV("div",{className:"text-sm text-gray-500 ml-6 mt-1 line-clamp-2 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:e.description}},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:273,columnNumber:27},void 0),e.teacher&&s.jsxDEV("p",{className:"text-xs text-amber-600 ml-6 mt-1",children:" Already assigned to another teacher"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:279,columnNumber:27},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:259,columnNumber:23},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:258,columnNumber:21},void 0)},e.id,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:251,columnNumber:19},void 0))},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:246,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:242,columnNumber:11},void 0),b.length>0&&s.jsxDEV("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:s.jsxDEV("p",{className:"text-sm text-blue-800",children:[s.jsxDEV("strong",{children:b.length},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:295,columnNumber:17},void 0)," course",1!==b.length?"s":""," selected"]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:294,columnNumber:15},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:293,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:186,columnNumber:9},void 0),s.jsxDEV("div",{className:"flex justify-end gap-3 p-6 border-t bg-gray-50",children:[s.jsxDEV(d,{variant:"outline",onClick:t,disabled:D,children:"Cancel"},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:304,columnNumber:11},void 0),s.jsxDEV(d,{onClick:async()=>{if(0!==r.length&&0!==b.length&&E?.id){j(!0);try{const e=b.flatMap(e=>r.map(s=>({courseId:e,teacherId:s,promise:pe(e,s,E.id).catch(n=>(console.error(`Failed to assign course ${e} to teacher ${s}:`,{error:n,message:n?.message,code:n?.code,details:n?.details}),{error:n,courseId:e,teacherId:s}))}))),s=await Promise.all(e.map(e=>e.promise)),a=s.filter(e=>e&&"error"in e),i=s.length-a.length;a.length>0?(console.error("Assignment failures:",a),n.error(`Assigned ${i} course(s) successfully, but ${a.length} failed. Some courses may already be assigned.`)):n.success(`Successfully assigned ${b.length} course(s) to ${r.length} teacher(s)`),N([]),g(new Set),o(),t()}catch(e){console.error("Error assigning courses:",{error:e,message:e?.message,stack:e?.stack}),n.error("Failed to assign courses. Please try again.")}finally{j(!1)}}},disabled:0===b.length||D,className:"bg-orange-600 hover:bg-orange-700 text-white",children:D?s.jsxDEV(s.Fragment,{children:[s.jsxDEV("span",{className:"animate-spin mr-2",children:""},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:314,columnNumber:17},void 0),"Assigning..."]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:313,columnNumber:15},void 0):`Assign ${b.length} Course${1!==b.length?"s":""}`},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:307,columnNumber:11},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:303,columnNumber:9},void 0)]},void 0,!0,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:173,columnNumber:7},void 0)},void 0,!1,{fileName:"D:/ITWala Projects/eyogi-main/src/SSH/src/components/admin/BulkCourseAssignmentModal.tsx",lineNumber:172,columnNumber:5},void 0)};export{I as A,F as B,De as C,B as D,q as E,W as F,U as G,O as H,R as I,we as J,Ne as K,X as L,fe as M,Se as N,J as W,Q as a,me as b,T as c,re as d,H as e,G as f,ee as g,$ as h,Z as i,de as j,ge as k,k as l,L as m,M as n,ue as o,pe as p,be as q,ae as r,ne as s,he as t,ve as u,te as v,oe as w,se as x,ce as y,V as z};
