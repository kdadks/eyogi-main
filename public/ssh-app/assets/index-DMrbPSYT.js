import{c as e,r as s,j as r,u as t,N as a,L as n,a as l,F as i,b as c,z as o,d,e as m,f as u,g as x,h,i as g,k as p,l as b,m as f,n as j,o as y,p as v,q as N,s as w,O as C,t as S,U as k,X as _,M as A,S as I,C as E,v as P,w as U,x as z,y as M,A as D,B as L,D as O,E as q,G as F,R,H as $,I as Y,J as G,K as T,P as Z,Q as B,T as J,V as H,W as V,Y as W,Z as X}from"./vendor-YZd7eZtG.js";import{t as K,c as Q}from"./utils-BpqZfnrR.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();const ee="https://fxhmipivmuqgdtwzpeni.supabase.co",se=e(ee,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ4aG1pcGl2bXVxZ2R0d3pwZW5pIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgxMDA1MzAsImV4cCI6MjA3MzY3NjUzMH0.Y65Muw42omwVOTi1KiOFaDbNkiITiFS9KlsWy9Nc4xk",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storageKey:"eyogi-ssh-admin-console-auth"}}),re=e(ee,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ4aG1pcGl2bXVxZ2R0d3pwZW5pIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1ODEwMDUzMCwiZXhwIjoyMDczNjc2NTMwfQ.qds4eDB5fOwa-9i7iwD2qeqD5YBFWQqj5eZajaiUMzw",{auth:{autoRefreshToken:!1,persistSession:!1,detectSessionInUrl:!1}}),te=s.createContext(void 0),ae=()=>{const e=s.useContext(te);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},ne=({children:e})=>{const[t,a]=s.useState(null),[n,l]=s.useState(null),[i,c]=s.useState(!0),o=s.useCallback(async e=>{try{const{data:s,error:r}=await re.from("profiles").select("*").eq("id",e).single();if(r)return"PGRST116"===r.code?void l(null):void 0;l(s)}catch(s){}},[]);s.useEffect(()=>{let e=!0;(async()=>{const{data:{session:s}}=await se.auth.getSession();e&&(a((null==s?void 0:s.user)??null),(null==s?void 0:s.user)&&await o(s.user.id),c(!1))})();const{data:{subscription:s}}=se.auth.onAuthStateChange(async(s,r)=>{e&&(a((null==r?void 0:r.user)??null),(null==r?void 0:r.user)?await o(r.user.id):l(null),c(!1))});return()=>{e=!1,s.unsubscribe()}},[o]);const d={user:t,profile:n,loading:i,signIn:async(e,s)=>{try{const{error:r}=await se.auth.signInWithPassword({email:e,password:s});return{error:r}}catch(r){return{error:r}}},signOut:async()=>{await se.auth.signOut(),l(null)},isAdmin:null!==t,canAccess:(e,s)=>!!t};return r.jsx(te.Provider,{value:d,children:e})},le=s.createContext(void 0),ie={super_admin:["users.create","users.read","users.update","users.delete","courses.create","courses.read","courses.update","courses.delete","enrollments.read","enrollments.update","enrollments.approve","certificates.read","certificates.create","certificates.delete","analytics.read","analytics.export","settings.read","settings.update","permissions.read","permissions.update","content.create","content.read","content.update","content.delete","admin.access","admin.dashboard"],admin:["users.create","users.read","users.update","users.delete","courses.create","courses.read","courses.update","courses.delete","enrollments.read","enrollments.update","certificates.read","certificates.create","analytics.read","settings.read","permissions.read","content.create","content.read","content.update","content.delete","admin.access","admin.dashboard"],teacher:["courses.create","courses.read","courses.update","enrollments.read","enrollments.update","certificates.read","certificates.create","users.read","content.create","content.read","content.update","admin.access"],student:["courses.read","enrollments.read","certificates.read","content.read"],parent:["courses.read","enrollments.read","certificates.read","content.read"]},ce=({children:e})=>{const{user:t,profile:a,loading:n}=ae(),[l,i]=s.useState(!0);s.useEffect(()=>{i(n)},[n]);const c=()=>{const e=t&&!a?"super_admin":(null==a?void 0:a.role)||"student";return ie[e]||[]},o={canAccess:(e,s)=>{if(t)return!0;const r=`${e}.${s}`;return c().includes(r)},hasAnyPermission:e=>{const s=c();return e.some(e=>s.includes(e))},getUserPermissions:c,isLoading:l};return r.jsx(le.Provider,{value:o,children:e})},oe=({children:e,requiredRole:s,requiredPermission:n})=>{const{user:l,profile:i,loading:c,canAccess:o}=ae(),d=t();if(c)return r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!l)return r.jsx(a,{to:"/admin/login",state:{from:d},replace:!0});if(!i)return r.jsx(r.Fragment,{children:e});if(s){if("admin"===s&&!["admin","super_admin"].includes(i.role))return r.jsx(a,{to:"/admin/unauthorized",replace:!0});if("super_admin"===s&&"super_admin"!==i.role)return r.jsx(a,{to:"/admin/unauthorized",replace:!0});if("teacher"===s&&!["teacher","admin","super_admin"].includes(i.role))return r.jsx(a,{to:"/admin/unauthorized",replace:!0})}return n&&!o(n.resource,n.action)?r.jsx(a,{to:"/admin/unauthorized",replace:!0}):r.jsx(r.Fragment,{children:e})},de=()=>r.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[r.jsx("header",{className:"bg-white shadow-sm",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"flex justify-between items-center py-6",children:[r.jsx("div",{className:"flex items-center",children:r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"eYogi SSH"})}),r.jsx("div",{className:"flex items-center space-x-4",children:r.jsx(n,{to:"/admin/login",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Admin Login"})})]})})}),r.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[r.jsxs("div",{className:"text-center",children:[r.jsxs("h1",{className:"text-4xl font-bold text-gray-900 sm:text-5xl md:text-6xl",children:["Welcome to"," ",r.jsx("span",{className:"text-blue-600",children:"eYogi SSH"})]}),r.jsx("p",{className:"mt-3 max-w-md mx-auto text-base text-gray-500 sm:text-lg md:mt-5 md:text-xl md:max-w-3xl",children:"Secure Shell Access Portal for eYogi Gurukul. Manage your SSH connections and access with ease."})]}),r.jsx("div",{className:"mt-16",children:r.jsxs("div",{className:"grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3",children:[r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"flex items-center justify-center h-12 w-12 rounded-md bg-blue-500 text-white",children:r.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Secure Access"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Enterprise-grade security for all SSH connections"})]})]})}),r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"flex items-center justify-center h-12 w-12 rounded-md bg-green-500 text-white",children:r.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Easy Management"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Streamlined interface for managing SSH access"})]})]})}),r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"flex items-center justify-center h-12 w-12 rounded-md bg-purple-500 text-white",children:r.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"High Performance"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Fast and reliable SSH connections"})]})]})})]})}),r.jsx("div",{className:"mt-16 text-center",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Ready to Get Started?"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"Access the admin panel to manage SSH connections and user permissions."}),r.jsx(n,{to:"/admin/login",className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Access Admin Panel"})]})})]}),r.jsx("footer",{className:"bg-white border-t",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:r.jsx("div",{className:"text-center text-sm text-gray-500",children:r.jsx("p",{children:"Â© 2025 eYogi Gurukul. All rights reserved."})})})})]}),me=()=>{const{signIn:e,loading:t,isAdmin:a,user:n}=ae(),d=l(),[m,u]=s.useState(""),[x,h]=s.useState(""),[g,p]=s.useState(!1),[b,f]=s.useState(!1),j=s.useRef(!1);s.useEffect(()=>{!t&&n&&a&&!j.current&&(j.current=!0,d("/admin/dashboard",{replace:!0}))},[n,a,t,d]);return t?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:r.jsx("div",{className:"max-w-md w-full space-y-8 p-8",children:r.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"eYogi Gurukul SSH University"}),r.jsx("p",{className:"text-gray-600",children:"Admin Console"})]}),r.jsxs("form",{onSubmit:async s=>{s.preventDefault(),f(!0);try{const{error:s}=await e(m,x);if(s)return void o.error(s.message||"Login failed");o.success("Welcome to Admin Console")}catch(r){o.error("An unexpected error occurred")}finally{f(!1)}},className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),r.jsx("input",{id:"email",type:"email",value:m,onChange:e=>u(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"admin@eyogi.com"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{id:"password",type:g?"text":"password",value:x,onChange:e=>h(e.target.value),required:!0,className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password"}),r.jsx("button",{type:"button",onClick:()=>p(!g),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:g?r.jsx(i,{className:"h-5 w-5 text-gray-400"}):r.jsx(c,{className:"h-5 w-5 text-gray-400"})})]})]}),r.jsx("button",{type:"submit",disabled:b,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:b?r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Signing in..."]}):"Sign in to Admin Console"})]}),r.jsx("div",{className:"mt-6 text-center",children:r.jsx("p",{className:"text-xs text-gray-500",children:"Admin access only. Contact support if you need assistance."})})]})})})},ue=({isOpen:e,onClose:s})=>{var t,a,n,l;const{profile:i,canAccess:c,user:o,signOut:N}=ae(),w=[{name:"Dashboard",href:"/admin/dashboard",icon:d,permission:null},{name:"Users",href:"/admin/users",icon:m,permission:{resource:"users",action:"read"}},{name:"Courses",href:"/admin/courses",icon:u,permission:{resource:"courses",action:"read"}},{name:"Enrollments",href:"/admin/enrollments",icon:x,permission:{resource:"enrollments",action:"read"}},{name:"Certificates",href:"/admin/certificates",icon:h,permission:{resource:"certificates",action:"read"}},{name:"Content",href:"/admin/content",icon:g,permission:{resource:"content",action:"read"}},{name:"Analytics",href:"/admin/analytics",icon:p,permission:{resource:"analytics",action:"read"}},{name:"Permissions",href:"/admin/permissions",icon:b,permission:{resource:"permissions",action:"read"}},{name:"Settings",href:"/admin/settings",icon:f,permission:{resource:"settings",action:"read"}}].filter(e=>!e.permission||c(e.permission.resource,e.permission.action));return r.jsxs(r.Fragment,{children:[e&&r.jsx("div",{className:"fixed inset-0 z-40 lg:hidden",children:r.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:s})}),r.jsxs("div",{className:`\n        fixed inset-y-0 left-0 z-50 w-64 bg-white border-r border-gray-200 transform transition-transform duration-300 ease-in-out\n        ${e?"translate-x-0":"-translate-x-full lg:translate-x-0"}\n      `,children:[r.jsxs("div",{className:"flex items-center justify-between h-16 px-6 border-b border-gray-200",children:[r.jsx("div",{className:"flex items-center",children:r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"eYogi Admin"})}),r.jsx("button",{type:"button",className:"lg:hidden p-1 rounded-md text-gray-400 hover:text-gray-600",onClick:s,children:r.jsx(j,{className:"h-6 w-6"})})]}),r.jsx("nav",{className:"mt-8 px-4",children:r.jsx("div",{className:"space-y-1",children:w.map(e=>r.jsxs(y,{to:e.href,onClick:s,className:({isActive:e})=>"group flex items-center px-2 py-2 text-sm font-medium rounded-md "+(e?"bg-blue-50 border-r-2 border-blue-500 text-blue-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[r.jsx(e.icon,{className:"mr-3 h-5 w-5 flex-shrink-0","aria-hidden":"true"}),e.name]},e.name))})}),r.jsx("div",{className:"absolute bottom-0 w-full p-4 border-t border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white text-sm font-medium",children:(null==(t=null==i?void 0:i.full_name)?void 0:t.charAt(0))||(null==(n=null==(a=null==o?void 0:o.email)?void 0:a.charAt(0))?void 0:n.toUpperCase())||"A"})})}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-gray-700",children:(null==i?void 0:i.full_name)||(null==(l=null==o?void 0:o.email)?void 0:l.split("@")[0])||"Admin"}),r.jsx("p",{className:"text-xs text-gray-500 capitalize",children:(null==i?void 0:i.role)||"Admin"})]})]}),r.jsx("button",{onClick:N,className:"p-1 rounded-md text-gray-400 hover:text-red-600 hover:bg-red-50 transition-colors",title:"Sign out",children:r.jsx(v,{className:"h-5 w-5"})})]})})]})]})},xe=({onMenuClick:e})=>r.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("button",{type:"button",className:"lg:hidden p-2 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:e,children:r.jsx(N,{className:"h-6 w-6"})}),r.jsx("div",{className:"ml-4 lg:ml-0",children:r.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"eYogi Gurukul Admin"})})]}),r.jsx("div",{className:"flex items-center space-x-4",children:r.jsxs("button",{type:"button",className:"p-2 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100 relative",children:[r.jsx(w,{className:"h-6 w-6"}),r.jsx("span",{className:"absolute top-1 right-1 block h-2 w-2 rounded-full bg-red-400"})]})})]})}),he=()=>{const[e,t]=s.useState(!1);return r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(ue,{isOpen:e,onClose:()=>t(!1)}),r.jsxs("div",{className:"lg:pl-64",children:[r.jsx(xe,{onMenuClick:()=>t(!0)}),r.jsx("main",{className:"p-6",children:r.jsx(C,{})})]})]})},ge=()=>{const[e,t]=s.useState({totalUsers:0,totalCourses:0,totalEnrollments:0,totalCertificates:0,recentEnrollments:0,activeUsers:0}),[a,n]=s.useState(!0);s.useEffect(()=>{l()},[]);const l=async()=>{try{0;const e=new Date;e.setDate(e.getDate()-30);const[s,r,a,n,l,i]=await Promise.all([re.from("profiles").select("*",{count:"exact",head:!0}),re.from("courses").select("*",{count:"exact",head:!0}),re.from("enrollments").select("*",{count:"exact",head:!0}),re.from("certificates").select("*",{count:"exact",head:!0}),re.from("enrollments").select("*",{count:"exact",head:!0}).gte("created_at",e.toISOString()),re.from("profiles").select("*",{count:"exact",head:!0}).eq("status","active")]);t({totalUsers:s.count||0,totalCourses:r.count||0,totalEnrollments:a.count||0,totalCertificates:n.count||0,recentEnrollments:l.count||0,activeUsers:i.count||0})}catch(e){t({totalUsers:0,totalCourses:0,totalEnrollments:0,totalCertificates:0,recentEnrollments:0,activeUsers:0})}finally{n(!1)}},i=[{title:"Total Users",value:e.totalUsers,icon:m,color:"bg-blue-500",change:`+${e.recentEnrollments} this month`},{title:"Active Courses",value:e.totalCourses,icon:u,color:"bg-green-500",change:"All time"},{title:"Total Enrollments",value:e.totalEnrollments,icon:x,color:"bg-yellow-500",change:`+${e.recentEnrollments} recent`},{title:"Certificates Issued",value:e.totalCertificates,icon:h,color:"bg-purple-500",change:"All time"},{title:"Active Users",value:e.activeUsers,icon:S,color:"bg-indigo-500",change:"Currently active"},{title:"Monthly Growth",value:`${e.recentEnrollments}`,icon:p,color:"bg-pink-500",change:"Last 30 days"}];return a?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),r.jsx("p",{className:"text-gray-600",children:"Loading analytics..."})]}),r.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:[...Array(6)].map((e,s)=>r.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200",children:r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"p-3 rounded-lg bg-gray-200 animate-pulse",children:r.jsx("div",{className:"h-6 w-6 bg-gray-300 rounded"})})}),r.jsxs("div",{className:"ml-4 w-0 flex-1",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse mb-2 w-3/4"}),r.jsx("div",{className:"h-6 bg-gray-200 rounded animate-pulse mb-1 w-1/2"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-full"})]})]})})},s))})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),r.jsx("p",{className:"text-gray-600",children:"Welcome to the eYogi Gurukul Admin Console"})]}),r.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:i.map((e,s)=>r.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200",children:r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:`p-3 rounded-lg ${e.color}`,children:r.jsx(e.icon,{className:"h-6 w-6 text-white"})})}),r.jsx("div",{className:"ml-4 w-0 flex-1",children:r.jsxs("dl",{children:[r.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:e.title}),r.jsx("dd",{className:"flex items-baseline",children:r.jsx("div",{className:"text-2xl font-semibold text-gray-900",children:e.value.toLocaleString()})}),r.jsx("dd",{className:"text-sm text-gray-500",children:e.change})]})})]})})},s))}),r.jsxs("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Quick Actions"})}),r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[r.jsxs("button",{className:"p-4 text-left border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[r.jsx(m,{className:"h-8 w-8 text-blue-600 mb-2"}),r.jsx("h3",{className:"font-medium text-gray-900",children:"Add New User"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Create student or teacher account"})]}),r.jsxs("button",{className:"p-4 text-left border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[r.jsx(u,{className:"h-8 w-8 text-green-600 mb-2"}),r.jsx("h3",{className:"font-medium text-gray-900",children:"Create Course"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Set up a new course"})]}),r.jsxs("button",{className:"p-4 text-left border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[r.jsx(x,{className:"h-8 w-8 text-yellow-600 mb-2"}),r.jsx("h3",{className:"font-medium text-gray-900",children:"Manage Enrollments"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Review pending enrollments"})]}),r.jsxs("button",{className:"p-4 text-left border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[r.jsx(p,{className:"h-8 w-8 text-purple-600 mb-2"}),r.jsx("h3",{className:"font-medium text-gray-900",children:"View Reports"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Analytics and insights"})]})]})})]}),r.jsxs("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Recent Activity"})}),r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx("p",{children:"Activity feed will be implemented in Phase 2"}),r.jsx("p",{className:"text-sm",children:"Coming soon: Real-time enrollment updates, user registrations, and system events"})]})})]})]})},pe=[{value:"student",label:"Student",color:"bg-blue-100 text-blue-800"},{value:"teacher",label:"Teacher",color:"bg-green-100 text-green-800"},{value:"admin",label:"Admin",color:"bg-purple-100 text-purple-800"},{value:"super_admin",label:"Super Admin",color:"bg-red-100 text-red-800"},{value:"parent",label:"Parent",color:"bg-yellow-100 text-yellow-800"}],be=[{value:"active",label:"Active",color:"bg-green-100 text-green-800"},{value:"inactive",label:"Inactive",color:"bg-gray-100 text-gray-800"},{value:"suspended",label:"Suspended",color:"bg-red-100 text-red-800"},{value:"pending",label:"Pending",color:"bg-yellow-100 text-yellow-800"}];function fe({isOpen:e,onClose:t,onSuccess:a,user:n,mode:l}){const[i,c]=s.useState(!1),[d,m]=s.useState({email:"",password:"",full_name:"",role:"student",status:"active",phone:"",date_of_birth:"",address:"",emergency_contact:""});s.useEffect(()=>{m("edit"===l&&n?{email:n.email||"",password:"",full_name:n.full_name||"",role:n.role||"student",status:n.status||"active",phone:n.phone||"",date_of_birth:n.date_of_birth||"",address:n.address||"",emergency_contact:n.emergency_contact||""}:{email:"",password:"",full_name:"",role:"student",status:"active",phone:"",date_of_birth:"",address:"",emergency_contact:""})},[l,n,e]);const u=e=>{const{name:s,value:r}=e.target;m(e=>({...e,[s]:r}))};return e?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:r.jsx(k,{className:"h-5 w-5 text-blue-600"})}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"create"===l?"Create New User":"Edit User"})]}),r.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(_,{className:"h-5 w-5 text-gray-500"})})]}),r.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),d.email?"create"!==l||d.password?d.full_name?d.email&&!/\S+@\S+\.\S+/.test(d.email)?(o.error("Please enter a valid email address"),0):!("create"===l&&d.password&&d.password.length<6&&(o.error("Password must be at least 6 characters long"),1)):(o.error("Full name is required"),0):(o.error("Password is required for new users"),0):(o.error("Email is required"),0)){c(!0);try{if("create"===l){const{data:e,error:s}=await re.auth.admin.createUser({email:d.email,password:d.password,email_confirm:!0});if(s)throw new Error(`Authentication error: ${s.message}`);if(!e.user)throw new Error("Failed to create user account");const r={id:e.user.id,email:d.email,full_name:d.full_name,role:d.role,status:d.status,phone:d.phone||null,date_of_birth:d.date_of_birth||null,address:d.address||null,emergency_contact:d.emergency_contact||null,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},{error:t}=await re.from("profiles").insert([r]);if(t)throw await re.auth.admin.deleteUser(e.user.id),new Error(`Profile creation error: ${t.message}`);o.success("User created successfully!")}else{const e={full_name:d.full_name,role:d.role,status:d.status,phone:d.phone||null,date_of_birth:d.date_of_birth||null,address:d.address||null,emergency_contact:d.emergency_contact||null,updated_at:(new Date).toISOString()},{error:s}=await re.from("profiles").update(e).eq("id",n.id);if(s)throw new Error(`Update error: ${s.message}`);if(d.email!==n.email){const{error:e}=await re.auth.admin.updateUserById(n.id,{email:d.email});if(e)throw new Error(`Email update error: ${e.message}`)}if(d.password){const{error:e}=await re.auth.admin.updateUserById(n.id,{password:d.password});if(e)throw new Error(`Password update error: ${e.message}`)}o.success("User updated successfully!")}a(),t()}catch(s){o.error(s.message||"An error occurred while saving the user")}finally{c(!1)}}},className:"p-6 space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[r.jsx(A,{className:"h-4 w-4 inline mr-1"}),"Email Address *"]}),r.jsx("input",{type:"email",name:"email",value:d.email,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"user@example.com",required:!0})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[r.jsx(k,{className:"h-4 w-4 inline mr-1"}),"Full Name *"]}),r.jsx("input",{type:"text",name:"full_name",value:d.full_name,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"John Doe",required:!0})]}),("create"===l||"edit"===l)&&r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Password ","create"===l?"*":"(leave blank to keep current)"]}),r.jsx("input",{type:"password",name:"password",value:d.password,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"create"===l?"Enter password":"Enter new password",required:"create"===l,minLength:6})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),r.jsx("input",{type:"tel",name:"phone",value:d.phone,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"+1 (555) 123-4567"})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[r.jsx(I,{className:"h-4 w-4 inline mr-1"}),"Role *"]}),r.jsx("select",{name:"role",value:d.role,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:pe.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),r.jsx("select",{name:"status",value:d.status,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:be.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[r.jsx(E,{className:"h-4 w-4 inline mr-1"}),"Date of Birth"]}),r.jsx("input",{type:"date",name:"date_of_birth",value:d.date_of_birth,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Contact"}),r.jsx("input",{type:"text",name:"emergency_contact",value:d.emergency_contact,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Contact name and phone"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),r.jsx("input",{type:"text",name:"address",value:d.address,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Street address, city, state, zip"})]}),r.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200",children:[r.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:i?r.jsxs(r.Fragment,{children:[r.jsx(P,{className:"h-4 w-4 animate-spin"}),r.jsx("span",{children:"Saving..."})]}):r.jsxs(r.Fragment,{children:[r.jsx(U,{className:"h-4 w-4"}),r.jsx("span",{children:"create"===l?"Create User":"Update User"})]})})]})]})]})}):null}const je=()=>{const[e,t]=s.useState([]),[a,n]=s.useState(!0),[l,i]=s.useState(""),[d,m]=s.useState("all"),[u,x]=s.useState("all"),[h,g]=s.useState(!1),[p,b]=s.useState(null),{user:f}=ae();s.useEffect(()=>{j()},[]);const j=async()=>{try{n(!0);const{data:e,error:s}=await re.from("profiles").select("*").order("created_at",{ascending:!1});if(s)return void o.error("Failed to load users");const r=(e||[]).filter(e=>e.full_name&&e.email&&e.role&&e.id!==(null==f?void 0:f.id));t(r)}catch(e){o.error("Failed to load users")}finally{n(!1)}},y=e.filter(e=>{const s=e.full_name.toLowerCase().includes(l.toLowerCase())||e.email.toLowerCase().includes(l.toLowerCase())||e.student_id&&e.student_id.toLowerCase().includes(l.toLowerCase()),r="all"===d||e.role===d,t="all"===u||e.status===u;return s&&r&&t}),v=e=>{switch(e){case"super_admin":return"bg-red-100 text-red-800";case"admin":return"bg-purple-100 text-purple-800";case"teacher":return"bg-blue-100 text-blue-800";case"student":return"bg-green-100 text-green-800";case"parent":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},N=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":default:return"bg-gray-100 text-gray-800";case"suspended":return"bg-red-100 text-red-800";case"pending_verification":return"bg-yellow-100 text-yellow-800"}},w=e=>"super_admin"===e.role||e.id===(null==f?void 0:f.id);return a?r.jsx("div",{className:"flex items-center justify-center min-h-96",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),r.jsx("p",{className:"text-gray-600",children:"Manage students, teachers, and administrators"})]}),r.jsxs("button",{onClick:()=>{b(null),g(!0)},className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700",children:[r.jsx(z,{className:"h-5 w-5 mr-2"}),"Add User"]})]}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:r.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-4",children:[r.jsxs("div",{className:"relative",children:[r.jsx(M,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search users...",value:l,onChange:e=>i(e.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),r.jsx("div",{children:r.jsxs("select",{value:d,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"all",children:"All Roles"}),r.jsx("option",{value:"student",children:"Students"}),r.jsx("option",{value:"teacher",children:"Teachers"}),r.jsx("option",{value:"admin",children:"Admins"}),r.jsx("option",{value:"super_admin",children:"Super Admins"}),r.jsx("option",{value:"parent",children:"Parents"})]})}),r.jsx("div",{children:r.jsxs("select",{value:u,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"all",children:"All Statuses"}),r.jsx("option",{value:"active",children:"Active"}),r.jsx("option",{value:"inactive",children:"Inactive"}),r.jsx("option",{value:"suspended",children:"Suspended"}),r.jsx("option",{value:"pending_verification",children:"Pending"})]})}),r.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[r.jsx(D,{className:"h-4 w-4 mr-1"}),y.length," of ",e.length," users"]})]})}),r.jsxs("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden",children:[r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student ID"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map(e=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:r.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white text-sm font-medium",children:e.full_name.charAt(0)})})}),r.jsxs("div",{className:"ml-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.full_name}),w(e)&&r.jsx(L,{className:"h-4 w-4 text-red-500 ml-2",title:"Protected user"})]}),r.jsx("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${v(e.role)}`,children:e.role.replace("_"," ")})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${N(e.status)}`,children:e.status.replace("_"," ")})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.student_id||"-"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString()}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:r.jsxs("div",{className:"flex justify-end space-x-2",children:[r.jsx("button",{onClick:()=>{},className:"text-gray-600 hover:text-gray-900 p-1",title:"View user",children:r.jsx(c,{className:"h-4 w-4"})}),r.jsx("button",{onClick:()=>(e=>{"super_admin"!==e.role||(null==f?void 0:f.id)===e.id?(b(e),g(!0)):o.error("Cannot edit super admin users")})(e),disabled:w(e)&&(null==f?void 0:f.id)!==e.id,className:"p-1 "+(w(e)&&(null==f?void 0:f.id)!==e.id?"text-gray-300 cursor-not-allowed":"text-blue-600 hover:text-blue-900"),title:w(e)?"Protected user":"Edit user",children:r.jsx(O,{className:"h-4 w-4"})}),r.jsx("button",{onClick:()=>(async(e,s)=>{if("super_admin"!==s){if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{const{error:s}=await re.from("profiles").delete().eq("id",e);if(s)return void o.error("Failed to delete user");o.success("User deleted successfully"),j()}catch(r){o.error("Failed to delete user")}}else o.error("Cannot delete super admin users")})(e.id,e.role),disabled:w(e),className:"p-1 "+(w(e)?"text-gray-300 cursor-not-allowed":"text-red-600 hover:text-red-900"),title:w(e)?"Protected user":"Delete user",children:r.jsx(q,{className:"h-4 w-4"})})]})})]},e.id))})]})}),0===y.length&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(z,{className:"mx-auto h-12 w-12 text-gray-400"}),r.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No users found"}),r.jsx("p",{className:"mt-1 text-sm text-gray-500",children:l||"all"!==d||"all"!==u?"Try adjusting your search criteria.":"Get started by adding a new user."})]})]}),r.jsx(fe,{isOpen:h,onClose:()=>g(!1),onSuccess:()=>{g(!1),b(null),j()},user:p,mode:p?"edit":"create"})]})};function ye(...e){return K(Q(e))}function ve({className:e,variant:t="primary",size:a="md",loading:n=!1,disabled:l,children:i,...c}){const o=s.useRef(null),d=c.onMouseDown,m=c.onKeyDown,u={primary:"rgba(255,165,0,0.28)",secondary:"rgba(59,130,246,0.20)",outline:"rgba(99,102,241,0.08)",ghost:"rgba(0,0,0,0.08)",danger:"rgba(239,68,68,0.22)"},x=(e,s)=>{const r=o.current;if(!r)return;const a=r.getBoundingClientRect(),n=.5*Math.max(a.width,a.height),l=document.createElement("span");l.style.position="absolute",l.style.borderRadius="50%",l.style.pointerEvents="none",l.style.width=l.style.height=`${n}px`,l.style.left=e-a.left-n/2+"px",l.style.top=s-a.top-n/2+"px";const i=u[t]||"rgba(255,255,255,0.28)";l.style.background=i,l.style.transform="scale(0)",l.style.opacity="1",l.style.transition="transform 350ms cubic-bezier(.22,.9,.31,1), opacity 350ms ease-out",l.style.zIndex="10",r.appendChild(l),requestAnimationFrame(()=>{l.style.transform="scale(3)",l.style.opacity="0"});const c=()=>{try{l.remove()}catch(e){}};l.addEventListener("transitionend",c),setTimeout(c,400)};return r.jsxs("button",{ref:o,onMouseDown:e=>{null==d||d(e),x(e.clientX,e.clientY)},onKeyDown:e=>{if(null==m||m(e),"Enter"===e.key||" "===e.key||"Spacebar"===e.key){const e=o.current;if(!e)return;const s=e.getBoundingClientRect(),r=s.left+s.width/2,t=s.top+s.height/2;x(r,t)}},className:ye("inline-flex items-center justify-center rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none relative overflow-hidden","hover:shadow-[0_20px_40px_rgba(255,165,0,0.18)] active:scale-[0.99] transition-transform",{primary:"bg-orange-600 text-white hover:bg-orange-700 focus:ring-orange-500",secondary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-orange-500",ghost:"text-gray-700 hover:bg-gray-100 focus:ring-orange-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500"}[t],{sm:"px-3 py-1.5 text-sm min-h-[40px]",md:"px-4 py-2 text-sm min-h-[44px]",lg:"px-6 py-3 text-base min-h-[48px]"}[a],e),disabled:l||n,...c,children:[n&&r.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i]})}function Ne({className:e,children:s}){return r.jsxs("div",{className:ye("relative overflow-hidden rounded-lg","bg-gradient-to-br from-white/30 via-white/10 to-white/5 border border-white/20 backdrop-blur-md","shadow-[0_8px_30px_rgba(16,24,40,0.08)]",e),children:[r.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute inset-0",children:r.jsx("div",{className:"card-sheen"})}),s]})}function we({className:e,children:s}){return r.jsx("div",{className:ye("px-6 py-4 border-b border-gray-200",e),children:s})}function Ce({className:e,children:s}){return r.jsx("div",{className:ye("px-6 py-4",e),children:s})}function Se({className:e,children:s}){return r.jsx("h3",{className:ye("text-lg font-semibold leading-none tracking-tight",e),children:s})}function ke({className:e,children:s}){return r.jsx("p",{className:ye("text-sm text-gray-600",e),children:s})}const _e=({checked:e,onCheckedChange:s,disabled:t=!1,className:a=""})=>r.jsx("button",{type:"button",role:"switch","aria-checked":e,disabled:t,onClick:()=>s(!e),className:`\n        relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 ease-in-out\n        ${e?"bg-blue-600":"bg-gray-200"}\n        ${t?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n        ${a}\n      `,children:r.jsx("span",{className:`\n          inline-block h-4 w-4 transform rounded-full bg-white transition duration-200 ease-in-out\n          ${e?"translate-x-6":"translate-x-1"}\n        `})});function Ae({variant:e="default",size:s="md",className:t,children:a}){return r.jsx("span",{className:ye("inline-flex items-center font-medium rounded-full break-words text-center",{default:"bg-gray-100 text-gray-800",success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",danger:"bg-red-100 text-red-800",info:"bg-blue-100 text-blue-800"}[e],{sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-1 text-sm sm:px-3 sm:py-1.5 sm:text-base max-w-xs sm:max-w-none"}[s],t),children:a})}const Ie=e=>{switch(e.toLowerCase()){case"users":return r.jsx(Z,{className:"h-4 w-4"});case"courses":return r.jsx(T,{className:"h-4 w-4"});case"enrollments":return r.jsx(G,{className:"h-4 w-4"});case"settings":return r.jsx(Y,{className:"h-4 w-4"});case"permissions":return r.jsx(I,{className:"h-4 w-4"});default:return r.jsx(F,{className:"h-4 w-4"})}},Ee={admin:[],teacher:[],student:[]};function Pe(){const[e,t]=s.useState([]),[a,n]=s.useState(Ee),[l,i]=s.useState("admin"),[c,d]=s.useState(!1),[m,u]=s.useState(!1),[x,h]=s.useState(!0),{canAccess:g}=(()=>{const e=s.useContext(le);if(void 0===e)throw new Error("usePermissions must be used within a PermissionProvider");return e})(),p=async()=>{try{h(!0);const{data:e,error:s}=await re.from("permissions").select("*").order("resource, action");if(s)throw s;const{data:r,error:a}=await re.from("role_permissions").select("\n          id,\n          role,\n          permission_id,\n          created_at,\n          permission:permissions(*)\n        ");if(a)throw a;const l=(e||[]).map(e=>({id:e.id,name:e.name,description:e.description||"",icon:Ie(e.resource),resource:e.resource,action:e.action}));t(l);const i={admin:[],teacher:[],student:[]};(r||[]).forEach(e=>{i[e.role]&&i[e.role].push(e.permission_id)}),n(i)}catch(e){o.error("Failed to load permissions from database")}finally{h(!1)}};if(s.useEffect(()=>{p()},[]),!g("permissions","view"))return r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsxs("div",{className:"text-center",children:[r.jsx(F,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Access Denied"}),r.jsx("p",{className:"text-gray-500",children:"You don't have permission to view permissions."})]})});if(x)return r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsxs("div",{className:"text-center",children:[r.jsx(R,{className:"h-8 w-8 text-blue-500 mx-auto mb-4 animate-spin"}),r.jsx("p",{className:"text-gray-600",children:"Loading permissions..."})]})});const b=Object.keys(Ee),f=a[l]||[],j=e.reduce((e,s)=>{const r=s.resource;return e[r]||(e[r]=[]),e[r].push(s),e},{});return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Permission Management"}),r.jsx("p",{className:"text-gray-600",children:"Manage role-based permissions for your application"})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs(ve,{onClick:p,disabled:x,className:"flex items-center gap-2",style:{backgroundColor:"#6b7280",color:"white"},children:[r.jsx(R,{className:"h-4 w-4 "+(x?"animate-spin":"")}),"Refresh"]}),r.jsxs(ve,{onClick:async()=>{if(g("permissions","update"))try{d(!0);const{error:e}=await re.from("role_permissions").delete().eq("role",l);if(e)throw e;if(a[l].length>0){const e=a[l].map(e=>({role:l,permission_id:e})),{error:s}=await re.from("role_permissions").insert(e);if(s)throw s}u(!1),o.success(`Permissions saved for ${l} role`)}catch(e){o.error("Failed to save permissions to database")}finally{d(!1)}else o.error("You don't have permission to update permissions")},disabled:c||!m,className:"flex items-center gap-2",style:{backgroundColor:m?"#3b82f6":"#6b7280",color:"white"},children:[r.jsx(U,{className:"h-4 w-4"}),c?"Saving...":"Save Changes"]})]})]}),m&&r.jsxs("div",{className:"flex items-center gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[r.jsx(F,{className:"h-4 w-4 text-yellow-600"}),r.jsx("span",{className:"text-sm text-yellow-800",children:"You have unsaved changes"})]}),r.jsxs(Ne,{children:[r.jsxs(we,{children:[r.jsx(Se,{children:"Role Selection"}),r.jsx(ke,{children:"Select a role to manage its permissions. Changes are saved to the database."})]}),r.jsx(Ce,{children:r.jsx("div",{className:"flex gap-2",children:b.map(e=>r.jsxs(ve,{onClick:()=>i(e),className:"capitalize",style:{backgroundColor:l===e?"#3b82f6":"transparent",color:l===e?"white":"#374151",border:"1px solid #d1d5db"},children:[e,r.jsx(Ae,{variant:"default",className:"ml-2",children:(a[e]||[]).length})]},e))})})]}),r.jsx("div",{className:"space-y-6",children:Object.entries(j).map(([e,s])=>r.jsxs(Ne,{children:[r.jsxs(we,{children:[r.jsxs(Se,{className:"capitalize flex items-center gap-2",children:[s[0].icon,e," Permissions"]}),r.jsxs(ke,{children:["Manage ",e,"-related permissions for the ",l," role"]})]}),r.jsx(Ce,{children:r.jsx("div",{className:"space-y-4",children:s.map(e=>{const s=f.includes(e.id);return r.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-gray-100 rounded-md",children:e.icon}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-gray-900",children:e.name}),r.jsx("div",{className:"text-sm text-gray-500",children:e.description})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[s&&r.jsx($,{className:"h-4 w-4 text-green-500"}),r.jsx(_e,{checked:s,onCheckedChange:s=>((e,s)=>{n(r=>{const t=r[l]||[],a=s?[...t,e]:t.filter(s=>s!==e);return u(!0),{...r,[l]:a}}),o.success(`Permission ${s?"granted":"removed"} for ${l}`)})(e.id,s)})]})]},e.id)})})})]},e))})]})}const Ue=()=>r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});function ze(){return r.jsx(ne,{children:r.jsx(ce,{children:r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(s.Suspense,{fallback:r.jsx(Ue,{}),children:r.jsxs(B,{children:[r.jsx(J,{path:"/",element:r.jsx(de,{})}),r.jsx(J,{path:"/admin/login",element:r.jsx(me,{})}),r.jsxs(J,{path:"/admin/*",element:r.jsx(oe,{children:r.jsx(he,{})}),children:[r.jsx(J,{index:!0,element:r.jsx(a,{to:"dashboard",replace:!0})}),r.jsx(J,{path:"dashboard",element:r.jsx(ge,{})}),r.jsx(J,{path:"users",element:r.jsx(oe,{children:r.jsx(je,{})})}),r.jsx(J,{path:"permissions",element:r.jsx(oe,{children:r.jsx(Pe,{})})})]}),r.jsx(J,{path:"/access-denied",element:r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsxs("div",{className:"text-center",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"You don't have permission to access this resource."}),r.jsx("button",{onClick:()=>window.history.back(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Go Back"})]})})}),r.jsx(J,{path:"*",element:r.jsx(a,{to:"/",replace:!0})})]})}),r.jsx(H,{position:"top-right"})]})})})}V.createRoot(document.getElementById("root")).render(r.jsx(W.StrictMode,{children:r.jsx(X,{basename:"/ssh-app",future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:r.jsx(ze,{})})}));
